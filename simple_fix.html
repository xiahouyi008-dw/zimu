<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€é”®ä¿®å¤æŒ‘æˆ˜ç³»ç»Ÿ</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 90%;
        }
        h1 { margin-bottom: 30px; font-size: 2.5em; }
        .fix-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 20px;
            border-radius: 15px;
            cursor: pointer;
            margin: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76,175,80,0.4);
        }
        .fix-button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76,175,80,0.6);
        }
        .fix-button:active { transform: translateY(0); }
        .status { 
            margin: 30px 0; 
            padding: 20px; 
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            font-size: 18px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .instructions {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
            font-size: 16px;
            line-height: 1.6;
        }
        .instructions h3 {
            margin-top: 0;
            color: #ffd700;
        }
        .test-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .test-button {
            background: #2196F3;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 8px;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            background: #1976D2;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ æŒ‘æˆ˜ç³»ç»Ÿä¿®å¤å·¥å…·</h1>
        
        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <ol>
                <li><strong>ç¬¬ä¸€æ­¥ï¼š</strong>ç‚¹å‡»ä¸‹é¢çš„ã€ğŸ”§ ä¸€é”®ä¿®å¤ã€‘æŒ‰é’®</li>
                <li><strong>ç¬¬äºŒæ­¥ï¼š</strong>ä¿®å¤å®Œæˆåï¼Œç‚¹å‡»ã€ğŸ® æ‰“å¼€æ¸¸æˆã€‘</li>
                <li><strong>ç¬¬ä¸‰æ­¥ï¼š</strong>åœ¨æ¸¸æˆé‡Œç‚¹å‡»é‡‘å¸æµ‹è¯•æŒ‘æˆ˜è¿›åº¦</li>
                <li><strong>ç¬¬å››æ­¥ï¼š</strong>å›åˆ°æ­¤é¡µé¢æŸ¥çœ‹æµ‹è¯•ç»“æœ</li>
            </ol>
        </div>

        <button class="fix-button" onclick="applyFix()">ğŸ”§ ä¸€é”®ä¿®å¤</button>
        <button class="fix-button" onclick="openGame()" style="background: #ff9800;">ğŸ® æ‰“å¼€æ¸¸æˆ</button>
        
        <div id="status" class="status">ç‚¹å‡»ã€ä¸€é”®ä¿®å¤ã€‘å¼€å§‹</div>
        
        <div class="test-buttons">
            <button class="test-button" onclick="testClick()">ğŸ’° æµ‹è¯•ç‚¹å‡»</button>
            <button class="test-button" onclick="testAccuracy()">ğŸ¯ æµ‹è¯•ç²¾å‡†</button>
            <button class="test-button" onclick="showStatus()">ğŸ“Š æŸ¥çœ‹çŠ¶æ€</button>
        </div>
    </div>

    <script>
        let gameWindow = null;
        let fixApplied = false;

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.innerHTML = message;
            if (type === 'success') {
                status.style.background = 'rgba(76,175,80,0.3)';
            } else if (type === 'error') {
                status.style.background = 'rgba(244,67,54,0.3)';
            } else {
                status.style.background = 'rgba(255,255,255,0.2)';
            }
        }

        function applyFix() {
            updateStatus('ğŸ”„ æ­£åœ¨åº”ç”¨ä¿®å¤...', 'info');
            
            // åˆ›å»ºä¿®å¤è„šæœ¬
            const fixScript = `
                // ğŸš€ æŒ‘æˆ˜ç³»ç»Ÿä¸€é”®ä¿®å¤
                console.log('ğŸ”„ å¼€å§‹ä¸€é”®ä¿®å¤æŒ‘æˆ˜ç³»ç»Ÿ...');
                
                // ç¡®ä¿æŒ‘æˆ˜æ•°æ®å­˜åœ¨
                if (!window.dailyChallenges) {
                    console.log('âŒ æŒ‘æˆ˜æ•°æ®æœªåˆå§‹åŒ–');
                    return;
                }
                
                // âœ… é‡å†™updateChallengeProgresså‡½æ•°
                window.updateChallengeProgress = function(type, value = 1) {
                    console.log('ğŸ”„ æ›´æ–°æŒ‘æˆ˜è¿›åº¦:', type, '+', value);
                    
                    let updated = false;
                    let completedChallenge = null;
                    
                    window.dailyChallenges.forEach(challenge => {
                        if (challenge.type === type && !challenge.completed) {
                            challenge.progress += value;
                            
                            if (challenge.progress >= challenge.target) {
                                challenge.completed = true;
                                completedChallenge = challenge;
                                console.log('ğŸ‰ æŒ‘æˆ˜å®Œæˆ:', challenge.title);
                            }
                            
                            updated = true;
                        }
                    });
                    
                    if (updated) {
                        localStorage.setItem('dailyChallenges', JSON.stringify(window.dailyChallenges));
                        
                        // âœ… ç«‹å³æ›´æ–°æ˜¾ç¤º
                        updateChallengeDisplay();
                        
                        if (completedChallenge) {
                            setTimeout(() => {
                                if (typeof showNotification === 'function') {
                                    showNotification('ğŸ‰ æŒ‘æˆ˜å®Œæˆ: ' + completedChallenge.title, 'achievement');
                                }
                            }, 500);
                        }
                    }
                    
                    return updated;
                };
                
                // âœ… ç¡®ä¿æ˜¾ç¤ºå‡½æ•°å­˜åœ¨
                if (typeof window.updateChallengeDisplay !== 'function') {
                    window.updateChallengeDisplay = function() {
                        console.log('ğŸ”„ æ›´æ–°æŒ‘æˆ˜æ˜¾ç¤º...');
                        
                        window.dailyChallenges.forEach((challenge, index) => {
                            const challengeNum = index + 1;
                            const progressText = document.getElementById('progressText' + challengeNum);
                            const progressBar = document.getElementById('progress' + challengeNum);
                            
                            if (progressText) {
                                progressText.textContent = challenge.progress + '/' + challenge.target;
                            }
                            if (progressBar) {
                                const percentage = (challenge.progress / challenge.target) * 100;
                                progressBar.style.width = percentage + '%';
                            }
                        });
                    };
                }
                
                console.log('âœ… ä¿®å¤å®Œæˆï¼ç‚¹å‡»é‡‘å¸æµ‹è¯•æ•ˆæœ');
            `;
            
            // ä¿å­˜ä¿®å¤è„šæœ¬åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('challengeFix', fixScript);
            
            updateStatus('âœ… ä¿®å¤å·²å‡†å¤‡å®Œæˆï¼ç‚¹å‡»ã€æ‰“å¼€æ¸¸æˆã€‘åº”ç”¨ä¿®å¤', 'success');
            fixApplied = true;
        }

        function openGame() {
            try {
                gameWindow = window.open('/æ‘¸é±¼é‡‘å¸.html', 'game', 'width=1200,height=800');
                
                // ç­‰å¾…æ¸¸æˆåŠ è½½åæ³¨å…¥ä¿®å¤
                setTimeout(() => {
                    if (gameWindow && !gameWindow.closed) {
                        const script = gameWindow.document.createElement('script');
                        script.textContent = localStorage.getItem('challengeFix') || '';
                        gameWindow.document.head.appendChild(script);
                        updateStatus('âœ… ä¿®å¤å·²åº”ç”¨åˆ°æ¸¸æˆï¼ç°åœ¨ç‚¹å‡»é‡‘å¸æµ‹è¯•', 'success');
                    }
                }, 3000);
                
            } catch (error) {
                updateStatus('âŒ æ— æ³•æ‰“å¼€æ¸¸æˆï¼Œè¯·æ‰‹åŠ¨è®¿é—® http://localhost:3000/æ‘¸é±¼é‡‘å¸.html', 'error');
            }
        }

        function testClick() {
            if (gameWindow && !gameWindow.closed) {
                const script = gameWindow.document.createElement('script');
                script.textContent = 'updateChallengeProgress("click", 1); console.log("ğŸ’° ç‚¹å‡»æµ‹è¯•+1");';
                gameWindow.document.head.appendChild(script);
                updateStatus('ğŸ’° å·²å‘é€ç‚¹å‡»æµ‹è¯•', 'success');
            } else {
                updateStatus('âŒ è¯·å…ˆæ‰“å¼€æ¸¸æˆ', 'error');
            }
        }

        function testAccuracy() {
            if (gameWindow && !gameWindow.closed) {
                const script = gameWindow.document.createElement('script');
                script.textContent = 'updateChallengeProgress("accuracy", 1); console.log("ğŸ¯ ç²¾å‡†æµ‹è¯•+1");';
                gameWindow.document.head.appendChild(script);
                updateStatus('ğŸ¯ å·²å‘é€ç²¾å‡†æµ‹è¯•', 'success');
            } else {
                updateStatus('âŒ è¯·å…ˆæ‰“å¼€æ¸¸æˆ', 'error');
            }
        }

        function showStatus() {
            if (gameWindow && !gameWindow.closed) {
                const script = gameWindow.document.createElement('script');
                script.textContent = `
                    if (window.dailyChallenges) {
                        console.log('ğŸ“Š å½“å‰æŒ‘æˆ˜çŠ¶æ€:');
                        window.dailyChallenges.forEach((c, i) => {
                            console.log(\`æŒ‘æˆ˜\${i+1}: \${c.title} - \${c.progress}/\${c.target}\`);
                        });
                    }
                `;
                gameWindow.document.head.appendChild(script);
                updateStatus('ğŸ“Š çŠ¶æ€å·²å‘é€åˆ°æ§åˆ¶å°', 'success');
            } else {
                updateStatus('âŒ è¯·å…ˆæ‰“å¼€æ¸¸æˆ', 'error');
            }
        }

        // é¡µé¢åŠ è½½æç¤º
        window.onload = function() {
            updateStatus('ğŸš€ å‡†å¤‡å°±ç»ªï¼ç‚¹å‡»ã€ä¸€é”®ä¿®å¤ã€‘å¼€å§‹');
        };
    </script>
</body>
</html>