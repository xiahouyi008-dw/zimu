<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>摸鱼金币 - Slacker's Gold</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
            position: relative;
            margin: 0;
            padding: 0;
        }

        /* 主容器 - 游戏风格 */
        .main-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 
                0 0 60px rgba(255, 215, 0, 0.1),
                inset 0 0 40px rgba(255, 215, 0, 0.05);
            overflow: hidden;
            z-index: 5;
        }

        .main-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* 游戏风格头部 */
        .header {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 237, 78, 0.1) 100%);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            font-size: 28px;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* 等级系统样式 */
        .level-system {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 237, 78, 0.1) 100%);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .level-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .level-badge {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .experience-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .experience-fill {
            height: 100%;
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .experience-text {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
        }

        /* 统计网格 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 215, 0, 0.05) 100%);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.4);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
            font-family: 'Courier New', monospace;
        }

        /* 星空背景 */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: linear-gradient(135deg, #ffffff 0%, #ffd700 100%);
            border-radius: 50%;
            animation: twinkle 4s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .star.small {
            width: 2px;
            height: 2px;
            opacity: 0.6;
        }

        .star.medium {
            width: 3px;
            height: 3px;
            opacity: 0.8;
        }

        .star.large {
            width: 4px;
            height: 4px;
            opacity: 1;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            25% { opacity: 1; transform: scale(1.2); }
            50% { opacity: 0.6; transform: scale(1); }
            75% { opacity: 0.9; transform: scale(1.1); }
        }

        /* 中央数据面板 */
        .data-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            z-index: 10;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                0 0 40px rgba(255, 215, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            min-width: 320px;
            transition: all 0.3s ease;
        }

        .data-panel:hover {
            box-shadow: 
                0 12px 48px rgba(0, 0, 0, 0.4),
                0 0 60px rgba(255, 215, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transform: translate(-50%, -50%) scale(1.02);
        }

        .data-panel h1 {
            color: #ffd700;
            font-size: 28px;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            font-weight: 700;
            letter-spacing: 1px;
        }

        .data-item {
            margin: 20px 0;
            font-size: 16px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-value {
            color: #00ff88;
            font-size: 20px;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
            font-family: 'Courier New', monospace;
        }

        .efficiency {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 15px;
            font-weight: 500;
            background: rgba(255, 107, 107, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
        }

        /* 设置面板 */
        .settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 40px 30px 30px 30px;
            z-index: 100;
            display: none;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(255, 215, 0, 0.1);
            backdrop-filter: blur(20px);
            min-width: 350px;
            max-width: 90vw;
            transition: all 0.3s ease;
        }

        .settings-panel h2 {
            color: #ffd700;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
            font-size: 24px;
            letter-spacing: 0.5px;
        }

        .settings-panel input {
            width: 100%;
            padding: 12px 16px;
            margin: 12px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            color: #ffffff;
            font-size: 16px;
            font-weight: 400;
            transition: all 0.3s ease;
        }

        .settings-panel input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .settings-panel input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .settings-panel button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: none;
            border-radius: 12px;
            color: #1a1a2e;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            letter-spacing: 0.5px;
        }

        .settings-panel button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
            background: linear-gradient(135deg, #ffed4e 0%, #ffd700 100%);
        }

        .settings-panel button:active {
            transform: translateY(0);
        }

        .settings-panel .close-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
            color: white;
        }

        .settings-panel .close-btn:hover {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
            background: linear-gradient(135deg, #ff5252 0%, #ff6b6b 100%);
        }

        /* 每日挑战面板 */
        .daily-challenges-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            z-index: 50;
            display: none;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(255, 215, 0, 0.1);
            backdrop-filter: blur(20px);
            min-width: 500px;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            cursor: move;
            transition: all 0.3s ease;
        }
        
        /* 面板关闭按钮 */
        .panel-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 107, 107, 0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .panel-close-btn:hover {
            background: rgba(255, 107, 107, 1);
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        .daily-challenges-panel h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffd700;
            font-size: 24px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .challenges-content {
            margin-bottom: 20px;
        }

        .challenge-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            transition: all 0.3s ease;
        }

        .challenge-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.4);
        }

        .challenge-item.completed {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .challenge-icon {
            font-size: 30px;
            margin-right: 15px;
            min-width: 40px;
            text-align: center;
        }

        .challenge-info {
            flex: 1;
        }

        .challenge-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
            color: #fff;
        }

        .challenge-desc {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 8px;
        }

        .challenge-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            font-size: 12px;
            color: #ccc;
            min-width: 60px;
            text-align: right;
        }

        .challenge-reward {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }

        .reward-amount {
            font-weight: bold;
            color: #ffd700;
            font-size: 14px;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .claim-btn {
            padding: 6px 12px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .claim-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #ffc107, #ffd54f);
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .claim-btn:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            transform: none;
        }

        .claim-btn.claimed {
            background: #4caf50;
            color: white;
        }

        .claim-btn.available {
            background: linear-gradient(135deg, #ff6b6b, #ff8787);
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .challenges-timer {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .timer-title {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 5px;
        }

        .timer-display {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        /* 统计面板 */
        .stats-panel {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 30px 20px 20px 20px;
            z-index: 100;
            display: none;
            box-shadow: 
                0 6px 24px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(255, 215, 0, 0.1);
            backdrop-filter: blur(20px);
            width: 280px;
            max-height: 60vh;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        /* 成就通知 */
        .achievement-notification {
            position: fixed;
            top: 120px;
            right: 20px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.9) 0%, rgba(255, 237, 78, 0.9) 100%);
            color: #1a1a2e;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 200;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 
                0 6px 24px rgba(255, 215, 0, 0.3),
                0 0 30px rgba(255, 215, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 12px;
            max-width: 250px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .achievement-notification.show {
            transform: translateX(0);
        }

        .achievement-notification:hover {
            transform: translateX(0) scale(1.05);
            box-shadow: 
                0 12px 48px rgba(255, 215, 0, 0.5),
                0 0 60px rgba(255, 215, 0, 0.3);
        }

        /* 成就通知元素样式 */
        #achievement {
            position: fixed;
            top: 120px;
            right: 20px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.9) 0%, rgba(255, 237, 78, 0.9) 100%);
            color: #1a1a2e;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 200;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 
                0 6px 24px rgba(255, 215, 0, 0.3),
                0 0 30px rgba(255, 215, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 12px;
            max-width: 250px;
            text-align: center;
            backdrop-filter: blur(10px);
            display: none;
        }

        #achievement.show {
            transform: translateX(0);
            display: block;
        }

        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* 事件通知 */
        .event-notification {
            position: fixed;
            top: 180px;
            right: 20px;
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.9) 0%, rgba(162, 155, 254, 0.9) 100%);
            color: #ffffff;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
            z-index: 150;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 
                0 6px 24px rgba(108, 92, 231, 0.3),
                0 0 30px rgba(162, 155, 254, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 250px;
            max-width: 400px;
            word-wrap: break-word;
        }
        
        /* 通知消息内容 */
        .notification-message {
            flex: 1;
            margin-right: 12px;
            line-height: 1.4;
        }
        
        /* 通知关闭按钮 */
        .notification-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .notification-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .notification-close:active {
            transform: scale(0.95);
        }
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 12px;
            max-width: 250px;
            text-align: center;
            backdrop-filter: blur(10px);
            display: none;
        }

        /* 道具激活通知 */
        .event-notification.powerup-notification {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.9) 0%, rgba(238, 90, 82, 0.9) 100%);
            box-shadow: 
                0 6px 24px rgba(255, 107, 107, 0.4),
                0 0 30px rgba(238, 90, 82, 0.2);
            animation: powerupGlow 2s ease-in-out infinite;
        }

        /* 道具结束通知 */
        .event-notification.powerup-end-notification {
            background: linear-gradient(135deg, rgba(108, 117, 125, 0.9) 0%, rgba(73, 80, 87, 0.9) 100%);
            box-shadow: 
                0 6px 24px rgba(108, 117, 125, 0.3),
                0 0 30px rgba(73, 80, 87, 0.15);
        }

        @keyframes powerupGlow {
            0%, 100% { 
                box-shadow: 
                    0 6px 24px rgba(255, 107, 107, 0.4),
                    0 0 30px rgba(238, 90, 82, 0.2);
            }
            50% { 
                box-shadow: 
                    0 12px 48px rgba(255, 107, 107, 0.6),
                    0 0 60px rgba(238, 90, 82, 0.3);
            }
        }

        .event-notification.show {
            transform: translateX(0);
        }

        .event-notification:hover {
            transform: translateX(0) scale(1.05);
            box-shadow: 
                0 12px 48px rgba(108, 92, 231, 0.5),
                0 0 60px rgba(162, 155, 254, 0.3);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* 老板键 - Excel界面 */
        .boss-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 100%);
            color: #333;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            z-index: 1000;
            display: none;
            overflow: auto;
            animation: bossScreenFadeIn 0.3s ease-out;
        }

        @keyframes bossScreenFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .boss-screen.active {
            display: block;
        }

        .boss-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(33, 115, 70, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(45, 134, 89, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(240, 248, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            animation: bossScreenShimmer 4s ease-in-out infinite;
        }

        @keyframes bossScreenShimmer {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .excel-header {
            background: linear-gradient(135deg, #217346 0%, #2d8659 100%);
            color: white;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .excel-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: excelHeaderShine 3s infinite;
        }

        @keyframes excelHeaderShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .excel-menu {
            background: rgba(240, 240, 240, 0.95);
            border-bottom: 1px solid #d4d4d4;
            padding: 12px 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            backdrop-filter: blur(10px);
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .excel-menu::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(33, 115, 70, 0.05) 50%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .excel-menu:hover::before {
            opacity: 1;
            animation: menuScan 2s infinite;
        }

        @keyframes menuScan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .excel-menu span {
            padding: 6px 12px;
            border-radius: 4px;
            transition: all 0.2s ease;
            position: relative;
        }

        .excel-menu span:hover {
            background: rgba(33, 115, 70, 0.1);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .excel-menu span::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #217346, #2d8659);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .excel-menu span:hover::after {
            width: 80%;
        }

        .excel-grid {
            display: grid;
            grid-template-columns: 50px repeat(10, 100px);
            background: white;
            margin: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid #e1e1e1;
        }

        .excel-cell-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #e1e1e1;
            padding: 10px 12px;
            text-align: center;
            font-weight: 600;
            color: #495057;
            font-size: 12px;
        }

        .excel-cell {
            border: 1px solid #e1e1e1;
            padding: 10px 12px;
            font-size: 12px;
            min-height: 25px;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        .excel-cell:hover {
            background: rgba(33, 115, 70, 0.05);
            border-color: #217346;
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(33, 115, 70, 0.2);
            z-index: 1;
        }

        .excel-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 0%, rgba(33, 115, 70, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .excel-cell:hover::before {
            opacity: 1;
        }

        .excel-cell.selected {
            background: rgba(33, 115, 70, 0.1);
            border: 2px solid #217346;
            animation: cellSelected 0.5s ease;
        }

        @keyframes cellSelected {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1.02); }
        }

        /* 状态栏 */
        .excel-status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-top: 1px solid #d4d4d4;
            padding: 8px 20px;
            font-size: 12px;
            color: #495057;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1001;
            backdrop-filter: blur(10px);
        }

        .excel-status-left {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .excel-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
            animation: statusPulse 2s infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .excel-status-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* 老板模式快捷键提示 */
        .boss-mode-hint {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-size: 14px;
            text-align: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .boss-mode-hint.show {
            opacity: 1;
        }

        .boss-mode-hint kbd {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            margin: 0 2px;
        }

        /* 控制按钮 */
        .control-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 20;
        }

        .control-btn {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            letter-spacing: 0.5px;
            min-width: 70px;
            text-align: center;
        }

        .control-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.active {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a1a2e;
            border-color: transparent;
            font-weight: 600;
        }

        /* 金币收集效果 */
        .coin-collect-effect {
            position: fixed;
            color: #ffd700;
            font-size: 28px;
            font-weight: 700;
            font-family: 'Inter', sans-serif;
            z-index: 50;
            pointer-events: none;
            text-shadow: 
                0 0 10px rgba(255, 215, 0, 0.8),
                0 0 20px rgba(255, 215, 0, 0.4);
            animation: coinCollect 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @keyframes coinCollect {
            0% {
                transform: scale(0.5) translateY(0);
                opacity: 1;
            }
            50% {
                transform: scale(1.3) translateY(-30px);
                opacity: 1;
            }
            100% {
                transform: scale(0.8) translateY(-80px);
                opacity: 0;
            }
        }

        @keyframes specialCoinGlow {
            0%, 100% { filter: drop-shadow(0 0 10px currentColor); }
            50% { filter: drop-shadow(0 0 20px currentColor) drop-shadow(0 0 30px currentColor); }
        }

        @keyframes rainbowCoinRotate {
            0% { filter: hue-rotate(0deg) drop-shadow(0 0 15px #FF69B4); }
            25% { filter: hue-rotate(90deg) drop-shadow(0 0 15px #00FF00); }
            50% { filter: hue-rotate(180deg) drop-shadow(0 0 15px #00CED1); }
            75% { filter: hue-rotate(270deg) drop-shadow(0 0 15px #8A2BE2); }
            100% { filter: hue-rotate(360deg) drop-shadow(0 0 15px #FF69B4); }
        }

        @keyframes diamondCoinSparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(90deg); }
            50% { transform: scale(1.1) rotate(180deg); }
            75% { transform: scale(1.05) rotate(270deg); }
        }

        @keyframes goldenCoinPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.08); opacity: 0.9; }
        }

        @keyframes flameCoinBurn {
            0%, 100% { filter: drop-shadow(0 0 15px #FF4500); }
            25% { filter: drop-shadow(0 0 20px #FF6347) drop-shadow(0 0 5px #FF4500); }
            50% { filter: drop-shadow(0 0 25px #DC143C) drop-shadow(0 0 10px #FF4500); }
            75% { filter: drop-shadow(0 0 20px #FF6347) drop-shadow(0 0 5px #FF4500); }
        }

        @keyframes frostCoinFreeze {
            0%, 100% { filter: drop-shadow(0 0 15px #00BFFF); }
            50% { filter: drop-shadow(0 0 25px #87CEEB) drop-shadow(0 0 10px #00BFFF); }
        }

        @keyframes mysteryCoinShimmer {
            0%, 100% { filter: drop-shadow(0 0 15px #9370DB); opacity: 1; }
            25% { filter: drop-shadow(0 0 20px #DDA0DD) drop-shadow(0 0 10px #9370DB); opacity: 0.8; }
            50% { filter: drop-shadow(0 0 25px #8A2BE2) drop-shadow(0 0 15px #9370DB); opacity: 0.9; }
            75% { filter: drop-shadow(0 0 20px #DDA0DD) drop-shadow(0 0 10px #9370DB); opacity: 0.8; }
        }

        /* 暂停动画 */
        .paused * {
            animation-play-state: paused !important;
        }

        /* 暂停时的视觉提示效果 */
        .paused::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(2px);
            z-index: 9999;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .paused::after {
            content: '⏸️ 游戏暂停中';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #fff;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 40px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 10000;
            pointer-events: none;
            animation: pausePulse 2s ease-in-out infinite;
        }

        @keyframes pausePulse {
            0%, 100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
        }

        .paused .main-container {
            filter: grayscale(70%) brightness(0.7);
            transition: all 0.3s ease;
        }

        .paused .coin {
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        .paused .stat-card {
            border-color: rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
        }

        /* 音效控制 */
        .sound-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 20;
        }

        .sound-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 10px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            letter-spacing: 0.5px;
            min-width: 50px;
            text-align: center;
        }

        .sound-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .sound-btn.active {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #0a0a0a;
            border-color: transparent;
            font-weight: 600;
        }

        .sound-btn.active:hover {
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.3);
        }
    /* 响应式设计 */
        @media screen and (max-width: 768px) {
            .main-container {
                padding: 15px;
                gap: 15px;
            }
            
            .header {
                font-size: 24px;
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .stat-card {
                padding: 15px;
                font-size: 14px;
            }
            
            .stat-value {
                font-size: 20px;
            }
            
            .control-buttons {
                flex-direction: column;
                gap: 6px;
                bottom: 15px;
                right: 15px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 14px;
                min-width: auto;
                width: 100%;
            }
            
            .settings-panel, .stats-panel {
                width: 95%;
                max-width: 350px;
                padding: 20px;
            }
            
            .panel-title {
                font-size: 20px;
            }
            
            .event-notification {
                right: 15px;
                top: 120px;
                max-width: 200px;
                font-size: 11px;
                padding: 10px 14px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            
            .notification-close {
                width: 20px;
                height: 20px;
                font-size: 14px;
            }
            
            .sound-controls {
                top: 15px;
                left: 15px;
                flex-direction: column;
                gap: 6px;
            }
            
            .sound-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .excel-overlay {
                font-size: 12px;
            }
            
            .excel-header {
                font-size: 16px;
                padding: 8px 12px;
            }
            
            .excel-cell {
                padding: 4px 6px;
                min-width: 40px;
            }
        }
        
        @media screen and (max-width: 480px) {
            .header {
                font-size: 20px;
                padding: 12px;
            }
            
            .stat-card {
                padding: 12px;
                font-size: 12px;
            }
            
            .stat-value {
                font-size: 18px;
            }
            
            .event-notification {
                right: 10px;
                top: 10px;
                max-width: 250px;
                font-size: 12px;
                padding: 10px 14px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            
            .notification-close {
                width: 20px;
                height: 20px;
                font-size: 14px;
            }
            
            .coin-collect-effect {
                font-size: 16px;
                font-weight: 600;
            }
            
            .settings-panel, .stats-panel {
                width: 90%;
                max-width: 300px;
                padding: 15px;
            }
            
            .panel-title {
                font-size: 18px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
        }
        
        @media screen and (max-width: 320px) {
            .main-container {
                padding: 10px;
                gap: 10px;
            }
            
            .header {
                font-size: 18px;
                padding: 10px;
            }
            
            .stat-card {
                padding: 10px;
                font-size: 11px;
            }
            
            .stat-value {
                font-size: 16px;
            }
            
            .event-notification {
                right: 8px;
                top: 8px;
                max-width: 200px;
                font-size: 11px;
                padding: 8px 12px;
            }
            
            .sound-controls {
                bottom: 10px;
                left: 10px;
            }
            
            .sound-btn {
                padding: 6px 10px;
                font-size: 11px;
            }
            
            .stats-panel {
                right: 10px;
                width: 260px;
                max-height: 65vh;
                padding: 15px;
                top: 45%;
            }
            
            .stats-panel h3 {
                font-size: 16px;
                margin-bottom: 15px;
            }
            
            .stats-panel p {
                font-size: 12px;
                margin: 8px 0;
            }
            
            .stats-panel button {
                font-size: 12px;
                padding: 8px 15px;
                margin-top: 15px;
            }
        }
        
        /* 高DPI屏幕优化 */
        @media screen and (min-resolution: 2dppx) {
            .coin-collect-effect {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            
            .stat-value {
                font-weight: 600;
            }
        }
        
        /* 横屏模式优化 */
        @media screen and (orientation: landscape) and (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .btn {
                flex: 1;
                min-width: 120px;
            }
            
            .stats-panel {
                right: 15px;
                width: 280px;
                max-height: 60vh;
                padding: 20px;
            }
        }
        
        /* 暗色模式支持 */
        @media (prefers-color-scheme: dark) {
            .main-container {
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            }
            
            .stat-card {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(15px);
            }
            
            .settings-panel, .stats-panel {
                background: linear-gradient(135deg, #2d3561 0%, #1f2544 100%);
            }
            
            .excel-overlay {
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            }
        }

        /* 等级系统样式 */
        .level-system {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .level-display {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .level-display span {
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .level-badge {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            animation: badgeGlow 2s ease-in-out infinite alternate;
        }

        @keyframes badgeGlow {
            from { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }

        .experience-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .experience-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500, #FF6347);
            border-radius: 4px;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .experience-text {
            text-align: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 5px;
        }

        /* 连击显示 */
        .combo-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            color: #FF6347;
            text-shadow: 0 0 20px rgba(255, 99, 71, 0.8);
            z-index: 1000;
            display: none;
            pointer-events: none;
        }

        .combo-animation {
            animation: comboPulse 1.5s ease-out;
        }

        @keyframes comboPulse {
            0% { 
                transform: translate(-50%, -50%) scale(0.5); 
                opacity: 0;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.2); 
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(1); 
                opacity: 0;
            }
        }

        /* 成就徽章面板 */
        .achievement-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 100;
        }

        .achievement-title {
            font-size: 16px;
            font-weight: bold;
            color: #FFD700;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .achievement-badge {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
            opacity: 0.5;
        }

        .achievement-badge:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.2);
        }

        .achievement-badge.unlocked {
            opacity: 1;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            animation: badgeUnlock 0.6s ease-out;
        }

        @keyframes badgeUnlock {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        /* 粒子效果系统 */
        .particle-system {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 30;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-radius: 50%;
            animation: particleFloat 3s ease-out forwards;
            box-shadow: 0 0 6px rgba(255, 215, 0, 0.8);
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0);
                opacity: 0;
            }
        }

        .coin-trail {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #ffd700;
            border-radius: 50%;
            animation: trailFade 1s ease-out forwards;
            pointer-events: none;
        }

        @keyframes trailFade {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        /* 光环效果 */
        .glow-effect {
            position: absolute;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: glowPulse 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes glowPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.6;
            }
        }

        /* 连击脉冲动画 */
        @keyframes comboPulse {
            0% {
                transform: scale(1);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.1);
                filter: brightness(1.5);
            }
            100% {
                transform: scale(1);
                filter: brightness(1);
            }
        }

        /* 点击波纹效果 */
        .click-ripple {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.6) 0%, transparent 70%);
            transform: scale(0);
            animation: rippleExpand 0.6s ease-out forwards;
            pointer-events: none;
        }

        /* 排行榜样式 */
        .leaderboard {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 25px;
            min-width: 350px;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
            animation: leaderboardSlideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes leaderboardSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .leaderboard h3 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            font-weight: bold;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            margin: 8px 0;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .leaderboard-item:hover {
            background: rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
        }

        .leaderboard-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .leaderboard-item:hover::before {
            left: 100%;
        }

        .leaderboard-item.current-player {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.25), rgba(255, 215, 0, 0.15));
            border: 2px solid #ffd700;
            animation: leaderboardGlow 2s ease-in-out infinite;
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        .leaderboard-item.current-player:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(255, 215, 0, 0.4);
        }

        @keyframes leaderboardGlow {
            0%, 100% { 
                box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
                border-color: #ffd700;
            }
            50% { 
                box-shadow: 0 12px 35px rgba(255, 215, 0, 0.6);
                border-color: #ffed4e;
            }
        }

        .leaderboard-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .leaderboard-header h3 {
            margin: 0 0 15px 0;
            color: #ffd700;
            font-size: 24px;
        }
        
        .leaderboard-stats {
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #4ecdc4;
        }
        
        .leaderboard-tabs {
            display: flex;
            padding: 0 20px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 8px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            border-bottom: 2px solid transparent;
        }
        
        .tab-btn:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-btn.active {
            color: #4ecdc4;
            border-bottom-color: #4ecdc4;
        }
        
        #leaderboardTabContent {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .leaderboard-rank {
            color: #ffd700;
            font-weight: bold;
            min-width: 35px;
            font-size: 20px;
            text-align: center;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
            position: relative;
        }

        .leaderboard-rank.top-3 {
            color: #ffed4e;
            font-size: 24px;
            text-shadow: 0 0 12px rgba(255, 237, 78, 0.6);
        }

        .leaderboard-rank.top-3::after {
            content: '👑';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 12px;
            animation: crownFloat 3s ease-in-out infinite;
        }

        @keyframes crownFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }
        
        .leaderboard-player-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin: 0 10px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 8px;
            padding: 5px;
        }

        .leaderboard-player-info:hover {
            transform: translateX(5px);
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
        
        .leaderboard-name {
            color: #ffffff;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .leaderboard-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .leaderboard-value {
            color: #4ecdc4;
            font-weight: bold;
            font-size: 18px;
            text-align: right;
            min-width: 80px;
            transition: all 0.3s ease;
            position: relative;
        }

        .leaderboard-value:hover {
            color: #ffd700;
            transform: scale(1.05);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .leaderboard-score {
            color: #ffd700;
            font-weight: bold;
        }
        
        /* 玩家详情样式 */
        .player-profile {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            min-width: 350px;
            max-width: 400px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            z-index: 1001;
            display: none;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .profile-avatar {
            font-size: 48px;
            margin-right: 20px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ffd700;
        }
        
        .profile-basic-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 8px;
        }
        
        .profile-level {
            font-size: 16px;
            color: #4ecdc4;
            margin-bottom: 4px;
        }
        
        .profile-rank {
            font-size: 14px;
            color: #ffd700;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .profile-stat {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stat-icon {
            font-size: 24px;
            margin-right: 15px;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #4ecdc4;
        }
        
        .profile-actions {
            text-align: center;
        }
        
        .profile-btn {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }
        
        .profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        @keyframes rippleExpand {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        @keyframes leaderboardSlideIn {
            0% {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes leaderboardSlideOut {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
        }

        @keyframes profileSlideIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes profileSlideOut {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        /* 升级动画 */
        .level-up-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: levelUpFade 3s ease-out;
        }

        .level-up-content {
            text-align: center;
            color: white;
            animation: levelUpContent 3s ease-out;
        }

        .level-up-text {
            font-size: 72px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            margin-bottom: 20px;
            animation: levelUpText 3s ease-out;
        }

        .level-up-level {
            font-size: 48px;
            color: #FF6347;
            margin-bottom: 10px;
            animation: levelUpLevel 3s ease-out;
        }

        .level-up-bonus {
            font-size: 24px;
            color: #32CD32;
            animation: levelUpBonus 3s ease-out;
        }

        @keyframes levelUpFade {
            0%, 100% { opacity: 0; }
            20%, 80% { opacity: 1; }
        }

        @keyframes levelUpContent {
            0% { transform: scale(0.5); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes levelUpText {
            0% { transform: translateY(-100px); opacity: 0; }
            50% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @keyframes levelUpLevel {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(0deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        @keyframes levelUpBonus {
            0% { transform: translateY(50px); opacity: 0; }
            50% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* 成就解锁动画 */
        .achievement-unlock-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .achievement-unlock-notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .achievement-unlock-notification.hide {
            transform: translateX(400px);
            opacity: 0;
        }

        .achievement-icon {
            font-size: 2em;
            animation: achievementBounce 0.6s ease-out;
        }

        .achievement-content {
            flex: 1;
        }

        .achievement-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .achievement-name {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .achievement-sparkles {
            font-size: 1.5em;
            animation: sparkleRotate 2s linear infinite;
        }

        .achievement-particle {
            position: fixed;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 999;
            animation: achievementParticleExplosion var(--lifetime) ease-out forwards;
        }

        @keyframes achievementBounce {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        @keyframes sparkleRotate {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        @keyframes achievementParticleExplosion {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--vx), var(--vy)) scale(0);
                opacity: 0;
            }
        }
        
        /* 生命值系统样式 */
        .health-system {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            z-index: 1000;
        }
        
        .health-bar-container {
            width: 200px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .health-bar {
            height: 100%;
            background: #4CAF50;
            border-radius: 10px;
            transition: width 0.3s ease, background-color 0.3s ease;
        }
        
        .health-text {
            text-align: center;
            font-size: 12px;
            margin-top: 5px;
        }
        
        /* 游戏结束画面样式 */
        .game-over-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .game-over-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }
        
        .game-over-content h1 {
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .game-over-stats {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .game-over-stats p {
            margin: 10px 0;
            font-size: 16px;
        }
        
        .restart-button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .restart-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        </style>
</head>
<body>
    <!-- 星空背景 -->
    <div class="stars" id="stars"></div>

    <!-- 粒子效果系统 -->
    <div class="particle-system" id="particleSystem"></div>

    <!-- 主容器 -->
    <div class="main-container">
        <!-- 游戏头部 -->
        <div class="header">
            <div class="header-title">💰 摸鱼金币大师 💰</div>
            <div class="header-subtitle">专业摸鱼，快乐赚钱</div>
        </div>

        <!-- 等级系统 -->
        <div class="level-system">
            <div class="level-display">
                <span id="playerLevel">Lv.1</span>
                <div class="level-badge">⭐</div>
            </div>
            <div class="experience-bar">
                <div class="experience-fill" id="experienceBar"></div>
            </div>
            <div class="experience-text" id="experienceText">0/100</div>
        </div>
        
        <!-- 生命值系统 -->
        <div class="health-system">
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 10px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>❤️ 生命值</span>
                    <span id="healthText">100 / 100</span>
                </div>
                <button onclick="closeHealthSystem()" style="background: rgba(255,255,255,0.2); border: none; color: white; cursor: pointer; font-size: 18px; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'" title="关闭生命值显示">×</button>
            </div>
            <div class="health-bar-container">
                <div class="health-bar" id="healthBar"></div>
            </div>
        </div>

        <!-- 统计网格 -->
    <div class="stats-grid" style="opacity: 0.7;">
            <div class="stat-card">
                <div class="stat-label">今日收入</div>
                <div class="stat-value" id="totalIncome">¥ 0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">当前速率</div>
                <div class="stat-value" id="currentRate">¥ 0.00 / 分钟</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">在线时长</div>
                <div class="stat-value" id="onlineTime">00:00:00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">摸鱼效率</div>
                <div class="stat-value" id="efficiency">99.9%</div>
            </div>
        </div>
        
        <!-- 状态栏 -->
        <div class="excel-status-bar">
            <div class="excel-status-left">
                <div class="excel-status-indicator"></div>
                <span>就绪</span>
                <span id="excelTime"></span>
            </div>
            <div class="excel-status-right">
                <span>平均值: ¥422,667</span>
                <span>计数: 3</span>
                <span>求和: ¥1,268,000</span>
            </div>
        </div>
    </div>
    
    <!-- 老板模式快捷键提示 -->
    <div class="boss-mode-hint" id="bossModeHint">
        <div>🛡️ 老板模式已激活</div>
        <div style="margin-top: 10px; font-size: 12px;">
            按 <kbd>`</kbd> 或 <kbd>空格</kbd> 返回摸鱼
        </div>
    </div>

    <!-- 中央数据面板 -->
    <div class="data-panel" style="opacity: 0.7;">
        <div style="position: relative;">
            <button class="panel-close-btn" onclick="closeDataPanel()" title="关闭面板" style="position: absolute; top: 10px; right: 10px;">×</button>
            <h1>💰 摸鱼金币 💰</h1>
        </div>
        
        <!-- 等级和经验系统 -->
        <div class="level-system">
            <div class="level-display">
                <span id="playerLevel">Lv.1</span>
                <div class="level-badge">⭐</div>
            </div>
            <div class="experience-bar">
                <div class="experience-fill" id="experienceBar"></div>
            </div>
            <div class="experience-text" id="experienceText">0/100</div>
        </div>
        
        <!-- 生命值系统 -->
        <div class="health-system">
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 10px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>❤️ 生命值</span>
                    <span id="healthText">100 / 100</span>
                </div>
                <button onclick="closeHealthSystem()" style="background: rgba(255,255,255,0.2); border: none; color: white; cursor: pointer; font-size: 18px; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'" title="关闭生命值显示">×</button>
            </div>
            <div class="health-bar-container">
                <div class="health-bar" id="healthBar"></div>
            </div>
        </div>
        
        <div class="data-item">
            今日总收入: <span class="data-value" id="dataTotalIncome">¥ 0.00</span>
        </div>
        <div class="data-item">
            当前速率: <span class="data-value" id="dataCurrentRate">¥ 0.00 / 分钟</span>
        </div>
        <div class="data-item">
            在线时长: <span class="data-value" id="dataOnlineTime">00:00:00</span>
        </div>
        <div class="efficiency">
            摸鱼效率: <span id="dataEfficiency">99.9%</span>
        </div>
    </div>

    <!-- 连击显示 -->
    <div class="combo-display" id="comboDisplay" style="opacity: 0.8;"></div>

    <!-- 成就徽章面板 -->
    <div class="achievement-panel" id="achievementPanel" style="opacity: 0.7;">
        <div class="achievement-title">🏆 成就徽章</div>
        <div class="achievement-grid">
            <div class="achievement-badge" id="badge-firstVisit" title="首次访问">🌟</div>
            <div class="achievement-badge" id="badge-millionaire" title="百万富翁">💰</div>
            <div class="achievement-badge" id="badge-clickMaster" title="点击大师">👆</div>
            <div class="achievement-badge" id="badge-consistent7Days" title="连续7天">📅</div>
        </div>
    </div>

    <!-- 设置面板 -->
    <div class="settings-panel" id="settingsPanel">
        <button class="panel-close-btn" onclick="toggleSettings()" title="关闭面板">×</button>
        <h3>设置</h3>
        <input type="number" id="hourlyRate" placeholder="请输入您的时薪 (¥/小时)" value="50">
        <button onclick="saveSettings()">保存设置</button>
    </div>

    <!-- 每日挑战面板 -->
    <div class="daily-challenges-panel" id="dailyChallengesPanel">
        <button class="panel-close-btn" onclick="hideDailyChallenges()" title="关闭面板">×</button>
        <h3>🎯 每日挑战</h3>
        <div class="challenges-content" id="challengesContent">
            <div class="challenge-item" id="challenge1">
                <div class="challenge-icon">🎯</div>
                <div class="challenge-info">
                    <div class="challenge-title">摸鱼新手</div>
                    <div class="challenge-desc">点击金币达到100次</div>
                    <div class="challenge-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress1"></div>
                        </div>
                        <span class="progress-text" id="progressText1">0/100</span>
                    </div>
                </div>
                <div class="challenge-reward">
                    <div class="reward-amount">+500金币</div>
                    <button class="claim-btn" id="claim1" onclick="claimChallengeReward(1)" disabled>领取</button>
                </div>
            </div>
            
            <div class="challenge-item" id="challenge2">
                <div class="challenge-icon">⏰</div>
                <div class="challenge-info">
                    <div class="challenge-title">时间管理大师</div>
                    <div class="challenge-desc">累计摸鱼30分钟</div>
                    <div class="challenge-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress2"></div>
                        </div>
                        <span class="progress-text" id="progressText2">0/30分钟</span>
                    </div>
                </div>
                <div class="challenge-reward">
                    <div class="reward-amount">+1000金币</div>
                    <button class="claim-btn" id="claim2" onclick="claimChallengeReward(2)" disabled>领取</button>
                </div>
            </div>
            
            <div class="challenge-item" id="challenge3">
                <div class="challenge-icon">🎯</div>
                <div class="challenge-info">
                    <div class="challenge-title">精准点击</div>
                    <div class="challenge-desc">成功点击金币80次</div>
                    <div class="challenge-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress3"></div>
                        </div>
                        <span class="progress-text" id="progressText3">0/80</span>
                    </div>
                </div>
                <div class="challenge-reward">
                    <div class="reward-amount">+1500金币</div>
                    <button class="claim-btn" id="claim3" onclick="claimChallengeReward(3)" disabled>领取</button>
                </div>
            </div>
        </div>
        <div class="challenges-timer" id="challengesTimer">
            <div class="timer-title">下次刷新倒计时</div>
            <div class="timer-display" id="timerDisplay">23:59:59</div>
            <button onclick="resetChallenges()" style="margin-top: 10px; padding: 5px 10px; font-size: 12px; background: #ff6b6b; color: white; border: none; border-radius: 4px; cursor: pointer;">重置挑战</button>
        </div>
    </div>

    <!-- 统计面板 -->
    <div class="stats-panel" id="statsPanel">
        <button class="panel-close-btn" onclick="toggleStats()" title="关闭面板">×</button>
        <h3>📊 摸鱼统计</h3>
        <div id="statsContent">
            <p>总摸鱼时长: <span id="totalTime">0小时</span></p>
            <p>历史总收入: <span id="historicalIncome">¥0</span></p>
            <p>平均效率: <span id="avgEfficiency">99.9%</span></p>
            <p>今日可买奶茶: <span id="milkTeaCount">0杯</span></p>
        </div>
    </div>

    <!-- 成就通知 -->
    <div class="achievement" id="achievement"></div>

    <!-- 事件通知 -->
    <div class="event-notification" id="eventNotification"></div>

    <!-- 控制按钮 -->
    <div class="control-buttons">
        <button class="control-btn" onclick="showDailyChallenges()">🎯 每日挑战</button>
        <button class="control-btn" onclick="toggleSettings()">⚙️ 设置</button>
        <button class="control-btn" onclick="toggleStats()">📊 统计</button>
        <button class="control-btn" onclick="togglePause()">⏸️ 暂停</button>
        <button class="control-btn" onclick="showTotalIncome()">💰 查看总收入</button>
    </div>

    <!-- 音效控制 -->
    <div class="sound-controls">
        <button class="sound-btn active" id="soundToggle" onclick="toggleSound()">🔊 音效</button>
        <button class="sound-btn" id="bgmToggle" onclick="toggleBGM()">🎵 音乐</button>
        <button class="sound-btn" onclick="showLeaderboard()">🏆 排行</button>
    </div>

    <!-- 老板键 - Excel界面 -->
    <div class="boss-screen" id="bossScreen">
        <div class="excel-header">Microsoft Excel - 财务报表.xlsx</div>
        <div class="excel-menu">
            <span>文件</span>
            <span>开始</span>
            <span>插入</span>
            <span>页面布局</span>
            <span>公式</span>
            <span>数据</span>
            <span>审阅</span>
            <span>视图</span>
        </div>
        <div class="excel-grid">
            <div class="excel-cell-header"></div>
            <div class="excel-cell-header">A</div>
            <div class="excel-cell-header">B</div>
            <div class="excel-cell-header">C</div>
            <div class="excel-cell-header">D</div>
            <div class="excel-cell-header">E</div>
            <div class="excel-cell-header">F</div>
            <div class="excel-cell-header">G</div>
            <div class="excel-cell-header">H</div>
            <div class="excel-cell-header">I</div>
            <div class="excel-cell-header">J</div>
            
            <div class="excel-cell-header">1</div>
            <div class="excel-cell">季度收入统计</div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            
            <div class="excel-cell-header">2</div>
            <div class="excel-cell">项目</div>
            <div class="excel-cell">Q1</div>
            <div class="excel-cell">Q2</div>
            <div class="excel-cell">Q3</div>
            <div class="excel-cell">Q4</div>
            <div class="excel-cell">总计</div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            
            <div class="excel-cell-header">3</div>
            <div class="excel-cell">产品A</div>
            <div class="excel-cell">¥125,000</div>
            <div class="excel-cell">¥138,000</div>
            <div class="excel-cell">¥142,000</div>
            <div class="excel-cell">¥156,000</div>
            <div class="excel-cell">¥561,000</div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            
            <div class="excel-cell-header">4</div>
            <div class="excel-cell">产品B</div>
            <div class="excel-cell">¥89,000</div>
            <div class="excel-cell">¥95,000</div>
            <div class="excel-cell">¥103,000</div>
            <div class="excel-cell">¥118,000</div>
            <div class="excel-cell">¥405,000</div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            
            <div class="excel-cell-header">5</div>
            <div class="excel-cell">产品C</div>
            <div class="excel-cell">¥67,000</div>
            <div class="excel-cell">¥72,000</div>
            <div class="excel-cell">¥78,000</div>
            <div class="excel-cell">¥85,000</div>
            <div class="excel-cell">¥302,000</div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
            <div class="excel-cell"></div>
        </div>
    </div>

    <!-- 主容器结束 -->
    </div>

    <!-- Canvas for coins -->
    <canvas id="coinCanvas"></canvas>

    <!-- 排行榜 -->
    <div class="leaderboard" id="leaderboard" style="display: none;">
        <h3>🏆 摸鱼排行榜</h3>
        <div id="leaderboardContent"></div>
        <button class="control-btn" onclick="hideLeaderboard()" style="margin-top: 15px; width: 100%;">关闭</button>
    </div>

    <!-- 玩家详情 -->
    <div class="player-profile" id="playerProfile" style="display: none;">
        <div id="playerProfileContent"></div>
    </div>

    <script>
        // 全局变量
        let hourlyRate = 50;
        let totalIncome = 0;
        let currentRate = 0;
        let startTime = Date.now();
        let coins = [];
        let collectedCoins = 0;
        let isPaused = false;
        let isBossMode = false;
        let isMiniMode = false;
        let specialEvent = null;
        let gameIntervals = {}; // 游戏循环定时器
        let animationId = null; // 动画帧ID
        let challengeUpdateInterval = null; // 挑战计时器
        let achievements = {
            firstVisit: false,
            consistent7Days: false,
            millionaire: false,
            clickMaster: false,
            level10: false,
            level50: false,
            combo50: false,
            perfect100: false,
            powerUpCollector: false,
            survivor: false
        };

        // 游戏化系统变量
        let playerLevel = 1;
        let currentExp = 0;
        let expToNextLevel = 100;
        let comboCount = 0;
        let lastCoinTime = Date.now();
        let totalPlayTime = 0;
        let gameStats = {
            totalClicks: 0,
            perfectClicks: 0,
            maxCombo: 0,
            coinsPerSecond: 0,
            powerUpsCollected: 0,
            gamesSurvived: 0
        };

        // 生命值系统变量
        let playerHealth = 100;
        let maxHealth = 100;
        let healthRegenRate = 1; // 每秒恢复1点生命值
        let lastHealthRegen = Date.now();
        let gameOver = false;
        let healthLossPerMiss = 10; // 错过金币损失10点生命值
        let healthGainPerHit = 2;   // 击中金币获得2点生命值
        
        // 连击和完美点击系统变量
        let comboMultiplier = 1.0; // 连击倍率
        let perfectClickBonus = 1.0; // 完美点击加成

        // 道具系统变量
        let powerUps = {
            magnet: { active: false, duration: 0, endTime: 0 },
            slowTime: { active: false, duration: 0, endTime: 0 },
            doubleCoins: { active: false, duration: 0, endTime: 0 },
            shield: { active: false, duration: 0, endTime: 0 },
            autoClick: { active: false, duration: 0, endTime: 0 }
        };
        let availablePowerUps = [];
        let powerUpSpawnChance = 0.015; // 1.5%概率生成道具（平衡游戏难度）

        // 音效控制
        let soundEnabled = true;
        let bgmEnabled = false;
        let audioContext = null;
        let bgmOscillator = null;
        let bgmGain = null;
        let bgmFilter = null;
        let bgmPattern = 0;
        let bgmInterval = null;

        // 从localStorage加载数据
        function loadData() {
            const saved = localStorage.getItem('slackerGold');
            if (saved) {
                const data = JSON.parse(saved);
                hourlyRate = data.hourlyRate || 50;
                totalIncome = data.totalIncome || 0;
                collectedCoins = data.collectedCoins || 0;
                achievements = data.achievements || achievements;
                startTime = data.startTime || Date.now();
                
                // 加载游戏化数据
                playerLevel = data.playerLevel || 1;
                currentExp = data.currentExp || 0;
                expToNextLevel = data.expToNextLevel || 100;
                gameStats = data.gameStats || {
                    totalClicks: 0,
                    perfectClicks: 0,
                    maxCombo: 0,
                    coinsPerSecond: 0,
                    powerUpsCollected: 0,
                    gamesSurvived: 0
                };
                comboCount = 0;
                lastCoinTime = Date.now();
                totalPlayTime = data.totalPlayTime || 0;
                
                // 加载生命值数据
                playerHealth = data.playerHealth || 100;
                maxHealth = data.maxHealth || 100;
                gameOver = data.gameOver || false;
                
                // 加载道具系统数据
                powerUps = data.powerUps || powerUps;
                availablePowerUps = data.availablePowerUps || [];
                
                // 更新UI显示
                updateExperienceBar();
                updateCombo();
                updateHealthBar();
                
                // 解锁已获得的成就徽章
                if (achievements.firstVisit) unlockAchievementBadge('first-visit');
                if (achievements.millionaire) unlockAchievementBadge('millionaire');
                if (achievements.clickMaster) unlockAchievementBadge('click-master');
                if (achievements.level10) unlockAchievementBadge('level-10');
                if (achievements.level50) unlockAchievementBadge('level-50');
                if (achievements.combo50) unlockAchievementBadge('combo-50');
                if (achievements.perfect100) unlockAchievementBadge('perfect-100');
                if (achievements.powerUpCollector) unlockAchievementBadge('power-up-collector');
                if (achievements.survivor) unlockAchievementBadge('survivor');
            }
        }

        // 保存数据到localStorage
        function saveData() {
            const data = {
                hourlyRate,
                totalIncome,
                collectedCoins,
                achievements,
                startTime,
                playerLevel,
                currentExp,
                expToNextLevel,
                gameStats,
                playerHealth,
                maxHealth,
                gameOver,
                powerUps,
                availablePowerUps
            };
            localStorage.setItem('slackerGold', JSON.stringify(data));
        }

        // 经验值和等级系统
        function gainExperience(amount) {
            // 应用连击倍率加成
            if (achievements.clickMaster) {
                amount *= comboMultiplier;
            }
            
            // 应用完美点击加成
            if (achievements.perfect100) {
                amount *= perfectClickBonus;
            }
            
            currentExp += amount;
            let levelUpOccurred = false;
            
            // 检查升级
            while (currentExp >= expToNextLevel) {
                levelUp();
                levelUpOccurred = true;
            }
            
            // 更新经验条显示
            updateExperienceBar();
            
            // 击中金币时恢复生命值
            if (amount > 0 && !gameOver) {
                gainHealth(healthGainPerHit);
            }
            
            return levelUpOccurred;
        }

        function levelUp() {
            currentExp -= expToNextLevel;
            playerLevel++;
            expToNextLevel = Math.floor(expToNextLevel * 1.5); // 每级所需经验递增
            
            // 升级奖励
            hourlyRate += 5; // 每小时收入增加
            
            // 显示升级动画
            showLevelUpAnimation();
            
            // 播放升级音效
            playLevelUpSound();
            
            // 检查成就
            checkLevelAchievements();
        }

        function updateExperienceBar() {
            const expBar = document.getElementById('experienceBar');
            const expText = document.getElementById('experienceText');
            const levelText = document.getElementById('playerLevel');
            
            if (expBar && expText && levelText) {
                const progress = (currentExp / expToNextLevel) * 100;
                expBar.style.width = progress + '%';
                expText.textContent = `${currentExp}/${expToNextLevel}`;
                levelText.textContent = `Lv.${playerLevel}`;
            }
            
            // 更新生命值显示
            updateHealthBar();
        }

        function showLevelUpAnimation() {
            const levelUpDiv = document.createElement('div');
            levelUpDiv.className = 'level-up-animation';
            levelUpDiv.innerHTML = `
                <div class="level-up-content">
                    <div class="level-up-text">LEVEL UP!</div>
                    <div class="level-up-level">Lv.${playerLevel}</div>
                    <div class="level-up-bonus">+5 金币/小时</div>
                </div>
            `;
            
            document.body.appendChild(levelUpDiv);
            
            // 3秒后移除动画
            setTimeout(() => {
                levelUpDiv.remove();
            }, 3000);
        }

        function updateCombo() {
            const now = Date.now();
            const timeSinceLastCoin = now - lastCoinTime;
            
            // 如果2秒内收集金币，增加连击
            if (timeSinceLastCoin < 2000) {
                comboCount++;
            } else {
                comboCount = 1;
            }
            
            lastCoinTime = now;
            
            // 更新最大连击数
            if (comboCount > gameStats.maxCombo) {
                gameStats.maxCombo = comboCount;
            }
            
            // 显示连击效果
            if (comboCount > 1) {
                showComboEffect();
            }
            
            // 连击奖励经验
            if (comboCount > 5) {
                gainExperience(comboCount * 2);
            }
        }

        function showComboEffect() {
            const comboDiv = document.getElementById('comboDisplay');
            if (comboDiv) {
                comboDiv.textContent = `${comboCount}x COMBO!`;
                comboDiv.style.display = 'block';
                comboDiv.classList.remove('combo-animation');
                void comboDiv.offsetWidth; // 触发重排
                comboDiv.classList.add('combo-animation');
                
                setTimeout(() => {
                    comboDiv.style.display = 'none';
                }, 1500);
            }
        }
        
        // 更新生命值条
        function updateHealthBar() {
            const healthBar = document.getElementById('healthBar');
            const healthText = document.getElementById('healthText');
            
            if (healthBar && healthText) {
                const healthProgress = (playerHealth / maxHealth) * 100;
                healthBar.style.width = healthProgress + '%';
                healthText.textContent = `${Math.floor(playerHealth)} / ${maxHealth}`;
                
                // 根据生命值改变颜色
                if (healthProgress > 60) {
                    healthBar.style.backgroundColor = '#4CAF50';
                } else if (healthProgress > 30) {
                    healthBar.style.backgroundColor = '#FFC107';
                } else {
                    healthBar.style.backgroundColor = '#F44336';
                }
            }
        }
        
        // 更新生命值显示
        function updateHealthDisplay() {
            updateHealthBar();
        }
        
        // 扣除生命值
        function loseHealth(amount) {
            if (gameOver) return;
            
            // 摸鱼大师成就奖励：减少失误扣血
            if (achievements.level10) {
                amount *= 0.8; // -20%扣血
            }
            
            playerHealth = Math.max(0, playerHealth - amount);
            updateHealthBar();
            
            // 检查游戏结束
            if (playerHealth <= 0) {
                gameOver = true;
                showGameOver();
            }
        }
        
        // 恢复生命值
        function gainHealth(amount) {
            if (gameOver) return;
            
            playerHealth = Math.min(maxHealth, playerHealth + amount);
            updateHealthBar();
        }
        
        // 生命值恢复机制
        function updateHealthRegen() {
            if (gameOver) return;
            
            const now = Date.now();
            if (now - lastHealthRegen >= 1000) { // 每秒恢复一次
                gainHealth(healthRegenRate);
                lastHealthRegen = now;
            }
        }
        
        // 显示游戏结束画面
        function showGameOver() {
            // 更新生存统计
            gameStats.gamesSurvived++;
            
            const gameOverDiv = document.createElement('div');
            gameOverDiv.id = 'gameOverScreen';
            gameOverDiv.className = 'game-over-screen';
            gameOverDiv.innerHTML = `
                <div class="game-over-content">
                    <h1>游戏结束</h1>
                    <p>你的摸鱼生涯结束了...</p>
                    <div class="game-over-stats">
                        <p>总收入: ¥${totalIncome.toFixed(2)}</p>
                        <p>等级: Lv.${playerLevel}</p>
                        <p>收集金币: ${collectedCoins} 个</p>
                        <p>在线时间: ${document.getElementById('onlineTime').textContent}</p>
                    </div>
                    <button onclick="restartGame()" class="restart-button">重新开始</button>
                </div>
            `;
            
            document.body.appendChild(gameOverDiv);
            
            // 停止游戏循环
            isPaused = true;
        }
        
        // 重新开始游戏
        function restartGame() {
            // 重置游戏状态
            playerHealth = maxHealth;
            gameOver = false;
            isPaused = false;
            totalIncome = 0;
            currentRate = 0;
            hourlyRate = 0;
            playerLevel = 1;
            currentExp = 0;
            collectedCoins = 0;
            comboCount = 0;
            gameStats = {
                maxCombo: 0,
                perfectClicks: 0,
                powerUpsCollected: gameStats.powerUpsCollected,
                gamesSurvived: gameStats.gamesSurvived
            };
            
            // 重置道具系统
            powerUps = {
                magnet: { active: false, duration: 0, endTime: 0 },
                slowTime: { active: false, duration: 0, endTime: 0 },
                doubleCoins: { active: false, duration: 0, endTime: 0 },
                shield: { active: false, duration: 0, endTime: 0 },
                autoClick: { active: false, duration: 0, endTime: 0 }
            };
            availablePowerUps = [];
            
            // 移除游戏结束画面
            const gameOverDiv = document.getElementById('gameOverScreen');
            if (gameOverDiv) {
                gameOverDiv.remove();
            }
            
            // 重置时间
            startTime = Date.now();
            lastHealthRegen = Date.now();
            
            // 更新显示
            updateDisplay();
            updateExperienceBar();
            updateHealthBar();
            
            // 重新开始游戏循环
            animate();
            setInterval(updateIncome, 1000);
            setInterval(triggerSpecialEvent, 30000);
        }
        
        function checkLevelAchievements() {
            // 这个函数会在升级时调用，但主要成就检查在checkAchievements中
            checkAchievements();
        }

        // 道具系统相关函数
        function spawnPowerUp() {
            if (Math.random() < powerUpSpawnChance && availablePowerUps.length < 2) {
                const powerUpTypes = ['magnet', 'slowTime', 'doubleCoins', 'shield', 'autoClick'];
                const type = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
                
                const powerUp = {
                    id: Date.now() + Math.random(),
                    type: type,
                    x: Math.random() * (window.innerWidth - 100) + 50,
                    y: -50,
                    size: 40,
                    speed: 1.5, // 降低道具下落速度
                    collected: false,
                    rotation: 0, // 添加旋转动画
                    rotationSpeed: 0.02
                };
                
                availablePowerUps.push(powerUp);
            }
        }
        
        function updatePowerUps() {
            // 更新道具位置
            availablePowerUps = availablePowerUps.filter(powerUp => {
                if (powerUp.collected) return false;
                
                powerUp.y += powerUp.speed;
                powerUp.rotation += powerUp.rotationSpeed; // 添加旋转动画
                
                // 检查是否超出屏幕
                if (powerUp.y > window.innerHeight + 50) {
                    return false;
                }
                
                return true;
            });
            
            // 检查道具激活状态
            const now = Date.now();
            Object.keys(powerUps).forEach(type => {
                if (powerUps[type].active && now >= powerUps[type].endTime) {
                    deactivatePowerUp(type);
                }
            });
        }
        
        function collectPowerUp(powerUp) {
            powerUp.collected = true;
            activatePowerUp(powerUp.type);
            
            // 更新统计
            gameStats.powerUpsCollected++;
            
            // 显示收集效果
            showPowerUpEffect(powerUp.type);
            
            // 播放音效
            playPowerUpSound(powerUp.type);
        }
        
        function activatePowerUp(type) {
            const now = Date.now();
            let duration = 10000; // 10秒基础持续时间
            
            // 道具收藏家成就奖励：延长道具持续时间
            if (achievements.powerUpCollector) {
                duration *= 1.3; // +30%持续时间
            }
            
            powerUps[type] = {
                active: true,
                duration: duration,
                endTime: now + duration
            };
            
            // 特殊效果处理
            switch (type) {
                case 'shield':
                    // 护盾激活时防止生命值损失
                    break;
                case 'autoClick':
                    // 自动点击激活
                    startAutoClick();
                    break;
            }
            
            // 显示激活通知
            showPowerUpNotification(type, true);
            
            // 设置自动失效
            setTimeout(() => {
                if (powerUps[type].active) {
                    deactivatePowerUp(type);
                }
            }, duration);
        }
        
        function deactivatePowerUp(type) {
            powerUps[type].active = false;
            
            // 特殊效果处理
            switch (type) {
                case 'autoClick':
                    stopAutoClick();
                    break;
            }
            
            // 显示失效通知
            showPowerUpNotification(type, false);
        }
        
        function showPowerUpEffect(type) {
            const effectNames = {
                magnet: '🧲 磁铁激活！自动吸引金币',
                slowTime: '⏰ 时间减速！金币移动变慢',
                doubleCoins: '💰 双倍金币！收入翻倍',
                shield: '🛡️ 护盾激活！免疫伤害',
                autoClick: '🤖 自动点击！自动收集金币'
            };
            
            showEventNotification(effectNames[type] || '道具激活！', 'powerUp');
        }
        
        function showPowerUpNotification(type, activated) {
            const messages = {
                magnet: activated ? '🧲 磁铁：自动吸引金币' : '🧲 磁铁效果结束',
                slowTime: activated ? '⏰ 时间减速：金币移动变慢' : '⏰ 时间减速效果结束',
                doubleCoins: activated ? '💰 双倍金币：收入翻倍' : '💰 双倍金币效果结束',
                shield: activated ? '🛡️ 护盾：免疫伤害' : '🛡️ 护盾效果结束',
                autoClick: activated ? '🤖 自动点击：自动收集金币' : '🤖 自动点击效果结束'
            };
            
            if (messages[type]) {
                showEventNotification(messages[type], activated ? 'powerUp' : 'powerUpEnd');
            }
        }
        
        function startAutoClick() {
            // 自动点击机制
            const autoClickInterval = setInterval(() => {
                if (!powerUps.autoClick.active) {
                    clearInterval(autoClickInterval);
                    return;
                }
                
                // 找到最近的金币并自动点击
                if (coins.length > 0) {
                    const nearestCoin = coins.reduce((nearest, coin) => {
                        const distance1 = Math.abs(nearest.x - window.innerWidth / 2) + Math.abs(nearest.y - window.innerHeight / 2);
                        const distance2 = Math.abs(coin.x - window.innerWidth / 2) + Math.abs(coin.y - window.innerHeight / 2);
                        return distance2 < distance1 ? coin : nearest;
                    });
                    
                    // 模拟点击最近的金币
                    if (nearestCoin && !nearestCoin.collected) {
                        nearestCoin.collected = true;
                        collectCoin(nearestCoin);
                    }
                }
            }, 500); // 每0.5秒自动点击一次
        }
        
        function stopAutoClick() {
            // 停止自动点击在deactivatePowerUp中处理
        }
        
        function playPowerUpSound(type) {
            // 播放道具音效
            playSound('powerUp', 0.3);
        }

        // 绘制道具
        function drawPowerUp(ctx, powerUp) {
            ctx.save();
            ctx.translate(powerUp.x, powerUp.y);
            ctx.rotate(powerUp.rotation); // 应用旋转动画
            
            // 道具图标和颜色
            const powerUpStyles = {
                magnet: { color: '#FF6B6B', icon: '🧲', glow: '#FF6B6B' },
                slowTime: { color: '#4ECDC4', icon: '⏰', glow: '#4ECDC4' },
                doubleCoins: { color: '#FFD93D', icon: '💰', glow: '#FFD93D' },
                shield: { color: '#6BCF7F', icon: '🛡️', glow: '#6BCF7F' },
                autoClick: { color: '#A8E6CF', icon: '🤖', glow: '#A8E6CF' }
            };
            
            const style = powerUpStyles[powerUp.type];
            
            // 绘制外层发光效果
            ctx.shadowColor = style.glow;
            ctx.shadowBlur = 25;
            ctx.globalAlpha = 0.8;
            
            // 绘制外层光环
            ctx.beginPath();
            ctx.arc(0, 0, powerUp.size / 2 + 8, 0, Math.PI * 2);
            ctx.fillStyle = style.glow;
            ctx.fill();
            
            // 绘制道具背景
            ctx.shadowBlur = 15;
            ctx.beginPath();
            ctx.arc(0, 0, powerUp.size / 2, 0, Math.PI * 2);
            ctx.fillStyle = style.color;
            ctx.fill();
            
            // 绘制道具边框
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // 绘制内层高光
            ctx.beginPath();
            ctx.arc(-powerUp.size / 6, -powerUp.size / 6, powerUp.size / 6, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.fill();
            
            // 绘制道具图标
            ctx.shadowBlur = 0;
            ctx.globalAlpha = 1;
            ctx.fillStyle = '#FFFFFF';
            ctx.font = `bold ${powerUp.size * 0.35}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(style.icon, 0, 0);
            
            ctx.restore();
            
            // 检查是否与玩家碰撞
            const playerX = window.innerWidth / 2;
            const playerY = window.innerHeight / 2;
            const distance = Math.sqrt(
                Math.pow(powerUp.x - playerX, 2) + Math.pow(powerUp.y - playerY, 2)
            );
            
            if (distance < powerUp.size) {
                collectPowerUp(powerUp);
            }
        }

        // 初始化星空背景
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // 初始化Canvas
        function initCanvas() {
            const canvas = document.getElementById('coinCanvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.style.position = 'fixed';
            canvas.style.top = '0';
            canvas.style.left = '0';
            canvas.style.zIndex = '5';
            canvas.style.pointerEvents = 'auto'; // 启用鼠标事件接收
        }

        // 金币类
        class Coin {
            constructor() {
                this.x = Math.random() * window.innerWidth;
                this.y = -50;
                this.size = 20 + Math.random() * 25; // 金币大小范围 20-45px
                this.speed = 2 + Math.random() * 3;
                this.rotation = 0;
                this.rotationSpeed = (Math.random() - 0.5) * 0.1;
                this.collected = false;
                this.opacity = 1;
                this.id = Date.now() + Math.random();
                this.swingOffset = 0;
                this.originalX = this.x;
                this.type = 'normal'; // 金币类型: normal, diamond, rainbow, golden
                this.value = 0.5; // 基础价值
                this.color = '#FFD700';
                this.glowColor = '#FFD700';
                this.sparkleAnimation = false;
                this.rainbowAnimation = false;
                this.pulseAnimation = false;
            }

            update() {
                if (!isPaused && !this.collected) {
                    // 添加摆动效果
                    this.swingOffset = Math.sin(Date.now() * 0.003 + this.id) * 15;
                    this.x = this.originalX + this.swingOffset;
                    
                    // 磁铁效果 - 自动吸引金币
                    if (powerUps.magnet.active) {
                        const magnetRange = 200;
                        const playerX = window.innerWidth / 2;
                        const playerY = window.innerHeight / 2;
                        const distance = Math.sqrt(
                            Math.pow(this.x - playerX, 2) + Math.pow(this.y - playerY, 2)
                        );
                        
                        if (distance < magnetRange) {
                            const magnetForce = (1 - distance / magnetRange) * 8;
                            this.x += (playerX - this.x) * magnetForce * 0.02;
                            this.y += (playerY - this.y) * magnetForce * 0.02;
                        }
                    }
                    
                    // 时间减速效果
                    let currentSpeed = this.speed;
                    if (powerUps.slowTime.active) {
                        currentSpeed *= 0.3; // 速度降低70%
                    }
                    
                    // 添加重力加速度
                    currentSpeed += 0.05;
                    this.y += currentSpeed;
                    
                    // 旋转效果
                    this.rotation += this.rotationSpeed;
                    
                    // 检查是否点击收集
                    if (this.checkClick()) {
                        this.collect();
                    }
                    
                    // 移除超出屏幕的金币
                    if (this.y > window.innerHeight + 50) {
                        return false;
                    }
                } else if (this.collected && this.collectAnimation) {
                    // 处理收集动画
                    const elapsed = Date.now() - this.collectAnimation.startTime;
                    const progress = Math.min(elapsed / this.collectAnimation.duration, 1);
                    
                    // 使用缓动函数
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    
                    this.x = this.collectAnimation.startX + 
                           (this.collectAnimation.targetX - this.collectAnimation.startX) * easeOut;
                    this.y = this.collectAnimation.startY + 
                           (this.collectAnimation.targetY - this.collectAnimation.startY) * easeOut;
                    
                    // 添加缩放和旋转效果
                    this.rotation += 0.3;
                    this.size = this.size * (1 - progress * 0.5);
                    
                    if (progress >= 1) {
                        this.opacity = 0;
                    }
                }
                return true;
            }

            checkClick() {
                // 护盾激活时免疫误点击
            if (powerUps.shield.active) {
                // 护盾状态下，即使点击失误也不扣生命值
                return false;
            }
            
            // 获取鼠标位置并检测是否点击到金币
                const canvas = document.getElementById('coinCanvas');
                const rect = canvas.getBoundingClientRect();
                const mouseX = mousePos.x - rect.left;
                const mouseY = mousePos.y - rect.top;
                
                const distance = Math.sqrt(
                    Math.pow(mouseX - this.x, 2) + Math.pow(mouseY - this.y, 2)
                );
                
                return distance < this.size / 2;
            }

            collect() {
                this.collected = true;
                collectedCoins++;
                
                // 根据金币类型设置基础价值
                let collectValue = this.value || 0.5;
                
                // 特殊金币额外加成
                if (this.type === 'diamond') {
                    collectValue *= 2; // 钻石金币价值翻倍
                } else if (this.type === 'rainbow') {
                    // 彩虹金币连击加成
                    if (comboCount > 3) {
                        collectValue *= (1 + comboCount * 0.15);
                    }
                } else if (this.type === 'golden') {
                    // 黄金金币经验加成
                    collectValue *= 1.5;
                } else if (this.type === 'flame') {
                    // 火焰金币速度加成 - 额外价值
                    collectValue *= 1.3;
                } else if (this.type === 'frost') {
                    // 冰霜金币 - 高价值但难以点击
                    collectValue *= 1.8;
                } else if (this.type === 'mystery') {
                    // 神秘金币 - 随机倍数
                    const randomMultiplier = 0.5 + Math.random() * 2; // 0.5-2.5倍
                    collectValue *= randomMultiplier;
                    
                    // 随机触发特殊效果
                    if (Math.random() < 0.3) {
                        // 30%概率触发额外效果
                        const effects = ['combo', 'exp', 'rate'];
                        const effect = effects[Math.floor(Math.random() * effects.length)];
                        
                        switch (effect) {
                            case 'combo':
                                comboCount += 5;
                                showEventNotification('🔮 神秘效果：连击+5！');
                                break;
                            case 'exp':
                                gainExperience(50);
                                showEventNotification('🔮 神秘效果：经验+50！');
                                break;
                            case 'rate':
                                // 临时提升收入速率
                                const originalRate = hourlyRate;
                                hourlyRate *= 1.5;
                                showEventNotification('🔮 神秘效果：收入速率+50% (30秒)！');
                                setTimeout(() => {
                                    hourlyRate = originalRate;
                                }, 30000);
                                break;
                        }
                    }
                }
                
                // 连击加成
                if (comboCount > 5) {
                    collectValue *= (1 + comboCount * 0.1);
                }
                
                // 双倍金币道具效果
                if (powerUps.doubleCoins.active) {
                    collectValue *= 2;
                }
                
                // 等级加成
                collectValue *= (1 + playerLevel * 0.05);
                
                totalIncome += collectValue;
                
                // 获得经验值
                let expGain = 10;
                
                // 特殊金币额外经验
                if (this.type === 'diamond') {
                    expGain += 30; // 钻石金币额外30经验
                } else if (this.type === 'rainbow') {
                    expGain += 20; // 彩虹金币额外20经验
                } else if (this.type === 'golden') {
                    expGain += 25; // 黄金金币额外25经验
                } else if (this.type === 'flame') {
                    expGain += 15; // 火焰金币额外15经验
                } else if (this.type === 'frost') {
                    expGain += 35; // 冰霜金币额外35经验（因为难以点击）
                } else if (this.type === 'mystery') {
                    expGain += Math.floor(Math.random() * 40) + 10; // 随机10-50经验
                } else if (this.size > 35) {
                    expGain += 20; // 大尺寸金币额外经验
                }
                
                const levelUp = gainExperience(expGain);
                
                // 更新连击
                updateCombo();
                
                // 更新游戏统计
                gameStats.totalClicks++;
                if (this.type === 'diamond') {
                    gameStats.diamondCoins = (gameStats.diamondCoins || 0) + 1;
                } else if (this.type === 'rainbow') {
                    gameStats.rainbowCoins = (gameStats.rainbowCoins || 0) + 1;
                } else if (this.type === 'golden') {
                    gameStats.goldenCoins = (gameStats.goldenCoins || 0) + 1;
                } else if (this.type === 'flame') {
                    gameStats.flameCoins = (gameStats.flameCoins || 0) + 1;
                } else if (this.type === 'frost') {
                    gameStats.frostCoins = (gameStats.frostCoins || 0) + 1;
                } else if (this.type === 'mystery') {
                    gameStats.mysteryCoins = (gameStats.mysteryCoins || 0) + 1;
                } else if (this.size > 35) {
                    gameStats.perfectClicks++;
                }
                
                // 创建收集动画效果
                this.collectAnimation = {
                    startTime: Date.now(),
                    duration: 800,
                    startX: this.x,
                    startY: this.y,
                    targetX: window.innerWidth / 2,
                    targetY: 50
                };
                
                // 显示收集效果
                showCoinCollect(this.x, this.y, collectValue);
                
                // 创建连击效果
                createComboEffect(comboCount);
                
                // 如果是升级，显示升级效果
                if (levelUp) {
                    createGlowEffect(this.x, this.y);
                    showEventNotification(`🎉 恭喜升级到 Lv.${playerLevel}！`);
                }
                
                checkAchievements();
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.globalAlpha = this.collected ? this.opacity : 1;
                
                // 根据金币类型绘制不同效果
                let outerGradient, innerGradient, symbolColor, glowColor, isSpecial = false;
                
                switch (this.type) {
                    case 'diamond':
                        // 钻石金币 - 蓝色主题
                        outerGradient = ctx.createRadialGradient(0, 0, this.size * 0.7, 0, 0, this.size / 2);
                        outerGradient.addColorStop(0, '#00CED1');
                        outerGradient.addColorStop(0.7, '#20B2AA');
                        outerGradient.addColorStop(1, '#008B8B');
                        
                        innerGradient = ctx.createRadialGradient(-this.size * 0.3, -this.size * 0.3, 0, 0, 0, this.size * 0.4);
                        innerGradient.addColorStop(0, '#40E0D0');
                        innerGradient.addColorStop(0.6, '#00CED1');
                        innerGradient.addColorStop(1, '#008B8B');
                        
                        symbolColor = '#FFFFFF';
                        glowColor = '#40E0D0';
                        isSpecial = true;
                        break;
                        
                    case 'rainbow':
                        // 彩虹金币 - 渐变主题
                        outerGradient = ctx.createLinearGradient(-this.size/2, -this.size/2, this.size/2, this.size/2);
                        outerGradient.addColorStop(0, '#FF6B6B');
                        outerGradient.addColorStop(0.17, '#FFA500');
                        outerGradient.addColorStop(0.33, '#FFFF00');
                        outerGradient.addColorStop(0.5, '#00FF00');
                        outerGradient.addColorStop(0.67, '#00CED1');
                        outerGradient.addColorStop(0.83, '#4169E1');
                        outerGradient.addColorStop(1, '#8A2BE2');
                        
                        innerGradient = ctx.createRadialGradient(-this.size * 0.3, -this.size * 0.3, 0, 0, 0, this.size * 0.4);
                        innerGradient.addColorStop(0, '#FF69B4');
                        innerGradient.addColorStop(0.6, '#FF1493');
                        innerGradient.addColorStop(1, '#C71585');
                        
                        symbolColor = '#FFFFFF';
                        glowColor = '#FF69B4';
                        isSpecial = true;
                        break;
                        
                    case 'golden':
                        // 黄金金币 - 金色主题
                        outerGradient = ctx.createRadialGradient(0, 0, this.size * 0.7, 0, 0, this.size / 2);
                        outerGradient.addColorStop(0, '#FFD700');
                        outerGradient.addColorStop(0.7, '#FFA500');
                        outerGradient.addColorStop(1, '#FF8C00');
                        
                        innerGradient = ctx.createRadialGradient(-this.size * 0.3, -this.size * 0.3, 0, 0, 0, this.size * 0.4);
                        innerGradient.addColorStop(0, '#FFFF00');
                        innerGradient.addColorStop(0.6, '#FFD700');
                        innerGradient.addColorStop(1, '#DAA520');
                        
                        symbolColor = '#FFFFFF';
                        glowColor = '#FFFF00';
                        isSpecial = true;
                        break;
                        
                    case 'flame':
                        // 火焰金币 - 火焰主题
                        outerGradient = ctx.createRadialGradient(0, 0, this.size * 0.7, 0, 0, this.size / 2);
                        outerGradient.addColorStop(0, '#FF4500');
                        outerGradient.addColorStop(0.5, '#FF6347');
                        outerGradient.addColorStop(1, '#DC143C');
                        
                        innerGradient = ctx.createRadialGradient(-this.size * 0.3, -this.size * 0.3, 0, 0, 0, this.size * 0.4);
                        innerGradient.addColorStop(0, '#FF6347');
                        innerGradient.addColorStop(0.6, '#FF4500');
                        innerGradient.addColorStop(1, '#B22222');
                        
                        symbolColor = '#FFFFFF';
                        glowColor = '#FF4500';
                        isSpecial = true;
                        break;
                        
                    case 'frost':
                        // 冰霜金币 - 冰霜主题
                        outerGradient = ctx.createRadialGradient(0, 0, this.size * 0.7, 0, 0, this.size / 2);
                        outerGradient.addColorStop(0, '#00BFFF');
                        outerGradient.addColorStop(0.5, '#87CEEB');
                        outerGradient.addColorStop(1, '#4682B4');
                        
                        innerGradient = ctx.createRadialGradient(-this.size * 0.3, -this.size * 0.3, 0, 0, 0, this.size * 0.4);
                        innerGradient.addColorStop(0, '#87CEEB');
                        innerGradient.addColorStop(0.6, '#00BFFF');
                        innerGradient.addColorStop(1, '#4169E1');
                        
                        symbolColor = '#FFFFFF';
                        glowColor = '#00BFFF';
                        isSpecial = true;
                        break;
                        
                    case 'mystery':
                        // 神秘金币 - 紫色主题
                        outerGradient = ctx.createRadialGradient(0, 0, this.size * 0.7, 0, 0, this.size / 2);
                        outerGradient.addColorStop(0, '#9370DB');
                        outerGradient.addColorStop(0.5, '#DDA0DD');
                        outerGradient.addColorStop(1, '#8A2BE2');
                        
                        innerGradient = ctx.createRadialGradient(-this.size * 0.3, -this.size * 0.3, 0, 0, 0, this.size * 0.4);
                        innerGradient.addColorStop(0, '#DDA0DD');
                        innerGradient.addColorStop(0.6, '#9370DB');
                        innerGradient.addColorStop(1, '#663399');
                        
                        symbolColor = '#FFFFFF';
                        glowColor = '#9370DB';
                        isSpecial = true;
                        break;
                        
                    default:
                        // 普通金币
                        outerGradient = ctx.createRadialGradient(0, 0, this.size * 0.7, 0, 0, this.size / 2);
                        outerGradient.addColorStop(0, '#FFD700');
                        outerGradient.addColorStop(0.7, '#FFA500');
                        outerGradient.addColorStop(1, '#FF8C00');
                        
                        innerGradient = ctx.createRadialGradient(-this.size * 0.3, -this.size * 0.3, 0, 0, 0, this.size * 0.4);
                        innerGradient.addColorStop(0, '#FFED4E');
                        innerGradient.addColorStop(0.6, '#FFD700');
                        innerGradient.addColorStop(1, '#DAA520');
                        
                        symbolColor = '#8B4513';
                        glowColor = '#FFD700';
                        break;
                }
                
                // 绘制金币外圈
                ctx.beginPath();
                ctx.arc(0, 0, this.size / 2, 0, Math.PI * 2);
                ctx.fillStyle = outerGradient;
                ctx.fill();
                
                // 绘制内圈
                ctx.beginPath();
                ctx.arc(0, 0, this.size * 0.42, 0, Math.PI * 2);
                ctx.fillStyle = innerGradient;
                ctx.fill();
                
                // 绘制高光
                const highlightGradient = ctx.createRadialGradient(-this.size * 0.4, -this.size * 0.4, 0, -this.size * 0.2, -this.size * 0.2, this.size * 0.2);
                highlightGradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
                highlightGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                
                ctx.beginPath();
                ctx.arc(-this.size * 0.3, -this.size * 0.3, this.size * 0.15, 0, Math.PI * 2);
                ctx.fillStyle = highlightGradient;
                ctx.fill();
                
                // 绘制金币符号
                ctx.fillStyle = symbolColor;
                ctx.font = `bold ${this.size * 0.4}px 'Inter', sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('$', 0, 0);
                
                // 添加外发光效果
                ctx.shadowColor = glowColor;
                ctx.shadowBlur = isSpecial ? 25 : 15;
                ctx.fillText('$', 0, 0);
                ctx.shadowBlur = 0;
                
                // 特殊金币添加额外效果
                if (isSpecial) {
                    // 外圈光环
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size * 0.6, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // 内部装饰圈
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size * 0.35, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // 特殊效果：旋转星星
                    if (this.type === 'diamond') {
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                        ctx.font = `${this.size * 0.2}px serif`;
                        for (let i = 0; i < 6; i++) {
                            const angle = (Date.now() * 0.002 + i * Math.PI / 3);
                            const x = Math.cos(angle) * this.size * 0.45;
                            const y = Math.sin(angle) * this.size * 0.45;
                            ctx.fillText('✦', x, y);
                        }
                    }
                    
                    // 火焰金币效果
                    if (this.type === 'flame') {
                        // 火焰粒子效果
                        ctx.fillStyle = 'rgba(255, 69, 0, 0.6)';
                        for (let i = 0; i < 8; i++) {
                            const angle = (Date.now() * 0.005 + i * Math.PI / 4);
                            const radius = this.size * 0.7;
                            const x = Math.cos(angle) * radius;
                            const y = Math.sin(angle) * radius;
                            const size = this.size * 0.1;
                            ctx.beginPath();
                            ctx.arc(x, y, size, 0, Math.PI * 2);
                            ctx.fill();
                        }
                    }
                    
                    // 冰霜金币效果
                    if (this.type === 'frost') {
                        // 冰霜结晶效果
                        ctx.strokeStyle = 'rgba(135, 206, 235, 0.8)';
                        ctx.lineWidth = 2;
                        for (let i = 0; i < 6; i++) {
                            const angle = (Date.now() * 0.003 + i * Math.PI / 3);
                            const radius = this.size * 0.5;
                            const x = Math.cos(angle) * radius;
                            const y = Math.sin(angle) * radius;
                            const innerRadius = this.size * 0.2;
                            const innerX = Math.cos(angle + Math.PI) * innerRadius;
                            const innerY = Math.sin(angle + Math.PI) * innerRadius;
                            
                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(innerX, innerY);
                            ctx.stroke();
                        }
                    }
                    
                    // 神秘金币效果
                    if (this.type === 'mystery') {
                        // 神秘符文效果
                        ctx.strokeStyle = 'rgba(147, 112, 219, 0.8)';
                        ctx.lineWidth = 2;
                        for (let i = 0; i < 4; i++) {
                            const angle = (Date.now() * 0.004 + i * Math.PI / 2);
                            const radius = this.size * 0.4;
                            const x = Math.cos(angle) * radius;
                            const y = Math.sin(angle) * radius;
                            
                            ctx.beginPath();
                            ctx.arc(x, y, this.size * 0.1, 0, Math.PI * 2);
                            ctx.stroke();
                        }
                        
                        // 中心神秘符号
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                        ctx.font = `${this.size * 0.3}px serif`;
                        ctx.fillText('?', 0, 0);
                    }
                }
                
                ctx.restore();
                
                if (this.collected) {
                    this.opacity -= 0.05;
                }
            }
        }

        // 显示金币收集效果
        function showCoinCollect(x, y, value) {
            const element = document.createElement('div');
            element.className = 'coin-collect';
            element.textContent = '+¥' + value.toFixed(2);
            element.style.left = x + 'px';
            element.style.top = y + 'px';
            document.body.appendChild(element);
            
            setTimeout(() => {
                document.body.removeChild(element);
            }, 1000);
            
            // 创建粒子效果
            createCoinParticles(x, y);
            
            // 播放金币音效
            playCoinSound();
        }

        // 创建金币粒子效果
        function createCoinParticles(x, y) {
            const particleSystem = document.getElementById('particleSystem');
            
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // 随机偏移
                const offsetX = (Math.random() - 0.5) * 100;
                const offsetY = (Math.random() - 0.5) * 100;
                
                particle.style.left = (x + offsetX) + 'px';
                particle.style.top = (y + offsetY) + 'px';
                
                // 随机延迟
                particle.style.animationDelay = (Math.random() * 0.5) + 's';
                
                particleSystem.appendChild(particle);
                
                // 清理粒子
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 3500);
            }
        }

        // 创建光环效果
        function createGlowEffect(x, y) {
            const particleSystem = document.getElementById('particleSystem');
            const glow = document.createElement('div');
            glow.className = 'glow-effect';
            glow.style.left = (x - 50) + 'px';
            glow.style.top = (y - 50) + 'px';
            
            particleSystem.appendChild(glow);
            
            setTimeout(() => {
                if (glow.parentNode) {
                    glow.parentNode.removeChild(glow);
                }
            }, 2000);
        }

        // 创建连击效果
        function createComboEffect(comboCount) {
            const comboDisplay = document.querySelector('.combo-display');
            if (comboCount >= 10) {
                comboDisplay.style.animation = 'none';
                setTimeout(() => {
                    comboDisplay.style.animation = 'comboPulse 0.5s ease-out';
                }, 10);
                
                // 创建特殊光环效果
                const rect = comboDisplay.getBoundingClientRect();
                createGlowEffect(rect.left + rect.width / 2, rect.top + rect.height / 2);
            }
        }

        // 生成金币
        function generateCoins() {
            if (!isPaused && !isBossMode && !gameOver) {
                const rate = specialEvent === 'toilet' ? 2 : 1;
                for (let i = 0; i < rate; i++) {
                    if (Math.random() < 0.3) {
                        coins.push(new Coin());
                    }
                }
                
                // 偶尔生成特殊金币
                if (Math.random() < 0.08) { // 增加特殊金币生成概率
                    const specialCoin = new Coin();
                    
                    // 随机选择特殊金币类型
                    const coinType = Math.random();
                    if (coinType < 0.2) {
                        // 钻石金币 - 高价值
                        specialCoin.type = 'diamond';
                        specialCoin.size = 40 + Math.random() * 10;
                        specialCoin.speed = 0.8 + Math.random() * 1.5;
                        specialCoin.rotationSpeed = (Math.random() - 0.5) * 0.3;
                        specialCoin.value = 50; // 基础价值50
                        specialCoin.color = '#00CED1'; // 钻石蓝
                        specialCoin.glowColor = '#40E0D0';
                        specialCoin.sparkleAnimation = true;
                        specialCoin.trailEffect = true;
                        
                        // 显示特殊事件通知
                        showEventNotification('💎 钻石金币出现！价值超高！');
                        
                    } else if (coinType < 0.35) {
                        // 彩虹金币 - 连击加成
                        specialCoin.type = 'rainbow';
                        specialCoin.size = 35 + Math.random() * 15;
                        specialCoin.speed = 1 + Math.random() * 2;
                        specialCoin.rotationSpeed = (Math.random() - 0.5) * 0.4;
                        specialCoin.value = 25; // 基础价值25
                        specialCoin.color = 'rainbow';
                        specialCoin.glowColor = '#FF69B4';
                        specialCoin.rainbowAnimation = true;
                        
                        // 显示特殊事件通知
                        showEventNotification('🌈 彩虹金币出现！连击加成！');
                        
                    } else if (coinType < 0.5) {
                        // 黄金金币 - 经验加成
                        specialCoin.type = 'golden';
                        specialCoin.size = 45 + Math.random() * 5;
                        specialCoin.speed = 0.5 + Math.random() * 1;
                        specialCoin.rotationSpeed = (Math.random() - 0.5) * 0.2;
                        specialCoin.value = 30; // 基础价值30
                        specialCoin.color = '#FFD700';
                        specialCoin.glowColor = '#FFFF00';
                        specialCoin.pulseAnimation = true;
                        
                        // 显示特殊事件通知
                        showEventNotification('⭐ 黄金金币出现！经验加成！');
                        
                    } else if (coinType < 0.65) {
                        // 火焰金币 - 速度加成
                        specialCoin.type = 'flame';
                        specialCoin.size = 38 + Math.random() * 8;
                        specialCoin.speed = 2 + Math.random() * 2; // 超快速度
                        specialCoin.rotationSpeed = (Math.random() - 0.5) * 0.5;
                        specialCoin.value = 35; // 基础价值35
                        specialCoin.color = '#FF4500'; // 火焰橙
                        specialCoin.glowColor = '#FF6347';
                        specialCoin.flameAnimation = true;
                        specialCoin.speedBoost = true;
                        
                        // 显示特殊事件通知
                        showEventNotification('🔥 火焰金币出现！速度超快！');
                        
                    } else if (coinType < 0.8) {
                        // 冰霜金币 - 减速效果
                        specialCoin.type = 'frost';
                        specialCoin.size = 42 + Math.random() * 6;
                        specialCoin.speed = 0.3 + Math.random() * 0.5; // 超慢速度
                        specialCoin.rotationSpeed = (Math.random() - 0.5) * 0.1;
                        specialCoin.value = 40; // 基础价值40
                        specialCoin.color = '#00BFFF'; // 深天蓝
                        specialCoin.glowColor = '#87CEEB';
                        specialCoin.frostAnimation = true;
                        specialCoin.slowEffect = true;
                        
                        // 显示特殊事件通知
                        showEventNotification('❄️ 冰霜金币出现！移动缓慢但价值高！');
                        
                    } else {
                        // 神秘金币 - 随机效果
                        specialCoin.type = 'mystery';
                        specialCoin.size = 35 + Math.random() * 20;
                        specialCoin.speed = Math.random() * 3; // 随机速度
                        specialCoin.rotationSpeed = (Math.random() - 0.5) * 0.6;
                        specialCoin.value = Math.floor(Math.random() * 80) + 20; // 20-100随机价值
                        specialCoin.color = '#9370DB'; // 紫色
                        specialCoin.glowColor = '#DDA0DD';
                        specialCoin.mysteryAnimation = true;
                        specialCoin.randomEffect = true;
                        
                        // 显示特殊事件通知
                        showEventNotification('🔮 神秘金币出现！效果未知！');
                    }
                    
                    coins.push(specialCoin);
                }
            }
        }

        // 动画循环
        function animate() {
            const canvas = document.getElementById('coinCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 更新和绘制金币
            coins = coins.filter(coin => {
                const keep = coin.update();
                if (keep && coin.opacity > 0) {
                    coin.draw(ctx);
                } else if (!keep && !gameOver) {
                    // 金币消失时扣除生命值
                    if (coin.type !== 'mystery' || Math.random() > 0.5) { // 神秘金币50%概率不扣血
                        // 护盾激活时免疫生命值损失
                        if (!powerUps.shield.active) {
                            loseHealth(healthLossPerMiss);
                        }
                    }
                }
                return keep && coin.opacity > 0;
            });
            
            // 更新和绘制道具
            updatePowerUps();
            availablePowerUps.forEach(powerUp => {
                drawPowerUp(ctx, powerUp);
            });
            
            // 随机生成道具
            if (Math.random() < 0.0003) { // 0.03%概率每帧生成道具（约每50秒一个）
                spawnPowerUp();
            }
            
            animationId = requestAnimationFrame(animate);
        }

        // 更新收入
        function updateIncome() {
            if (!isPaused && !isBossMode && !gameOver) {
                const now = Date.now();
                const elapsedMinutes = (now - startTime) / (1000 * 60);
                
                // 计算当前速率
                currentRate = hourlyRate / 60;
                
                // 根据特殊事件调整
                if (specialEvent === 'toilet') {
                    currentRate *= 2;
                } else if (specialEvent === 'blame') {
                    currentRate = 0;
                }
                
                // 增加收入
                totalIncome += currentRate / 60; // 每秒收入
                
                // 更新时间挑战进度
                updateChallengeProgress('time', 1000); // 每秒增加1000毫秒
                
                // 更新生命值恢复
                updateHealthRegen();
                
                updateDisplay();
                saveData();
            }
        }

        // 添加最小化模式样式
        function addMiniModeStyles() {
            const style = document.createElement('style');
            style.setAttribute('data-minimize-styles', 'true');
            style.textContent = `
                .minimize-indicator {
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.9);
                    color: white;
                    padding: 30px;
                    border-radius: 15px;
                    text-align: center;
                    z-index: 10000;
                    backdrop-filter: blur(10px);
                    border: 2px solid rgba(255, 215, 0, 0.5);
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
                }
                
                .minimize-content {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 15px;
                }
                
                .minimize-icon {
                    font-size: 48px;
                    animation: bounce 2s infinite;
                }
                
                .minimize-text {
                    font-size: 18px;
                    font-weight: bold;
                    color: #ffd700;
                }
                
                .restore-btn {
                    background: linear-gradient(45deg, #ff6b6b, #ffa500);
                    color: white;
                    border: none;
                    padding: 12px 24px;
                    border-radius: 25px;
                    font-size: 16px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
                }
                
                .restore-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
                }
                
                @keyframes bounce {
                    0%, 20%, 50%, 80%, 100% {
                        transform: translateY(0);
                    }
                    40% {
                        transform: translateY(-10px);
                    }
                    60% {
                        transform: translateY(-5px);
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        // 更新显示
        function updateDisplay() {
            // 更新统计卡片
            document.getElementById('totalIncome').textContent = '¥ ' + totalIncome.toFixed(2);
            document.getElementById('currentRate').textContent = '¥ ' + currentRate.toFixed(2) + ' / 分钟';
            
            // 更新数据面板
            document.getElementById('dataTotalIncome').textContent = '¥ ' + totalIncome.toFixed(2);
            document.getElementById('dataCurrentRate').textContent = '¥ ' + currentRate.toFixed(2) + ' / 分钟';
            
            const elapsed = Date.now() - startTime;
            const hours = Math.floor(elapsed / (1000 * 60 * 60));
            const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((elapsed % (1000 * 60)) / 1000);
            
            const timeText = String(hours).padStart(2, '0') + ':' + 
                           String(minutes).padStart(2, '0') + ':' + 
                           String(seconds).padStart(2, '0');
            
            document.getElementById('onlineTime').textContent = timeText;
            document.getElementById('dataOnlineTime').textContent = timeText;
            
            // 更新生命值显示
            updateHealthDisplay();
        }

        // 特殊事件
        function triggerSpecialEvent() {
            if (isPaused || isBossMode) return;
            
            const events = ['toilet', 'blame', 'king'];
            const event = events[Math.floor(Math.random() * events.length)];
            
            switch (event) {
                case 'toilet':
                    specialEvent = 'toilet';
                    showEventNotification('🚽 带薪拉屎时间！金币掉落速率翻倍！', 'paidRestroom');
                    setTimeout(() => {
                        specialEvent = null;
                        showEventNotification('带薪拉屎结束，继续努力摸鱼！', 'paidRestroom');
                    }, 120000); // 2分钟
                    break;
                    
                case 'blame':
                    specialEvent = 'blame';
                    showEventNotification('😤 同事甩锅！金币掉落暂停！', 'colleagueBlame');
                    document.body.style.filter = 'grayscale(100%)';
                    setTimeout(() => {
                        specialEvent = null;
                        document.body.style.filter = 'none';
                        showEventNotification('甩锅结束，继续摸鱼！', 'colleagueBlame');
                    }, 30000); // 30秒
                    break;
                    
                case 'king':
                    const bonus = 100 + Math.random() * 400;
                    totalIncome += bonus;
                    showEventNotification('👑 摸鱼王者！获得奖金 ¥' + bonus.toFixed(2), 'slackerKing');
                    showAchievement('摸鱼王者');
                    break;
            }
        }

        // 显示事件通知
        function showEventNotification(message, eventType = 'default') {
            const element = document.getElementById('eventNotification');
            
            // 添加关闭按钮
            element.innerHTML = `
                <span class="notification-message">${message}</span>
                <button class="notification-close">×</button>
            `;
            
            element.style.display = 'block';
            
            // 根据事件类型设置不同的样式
            element.className = 'event-notification';
            if (eventType === 'powerUp') {
                element.classList.add('powerup-notification');
            } else if (eventType === 'powerUpEnd') {
                element.classList.add('powerup-end-notification');
            }
            
            // 添加关闭按钮点击事件
            const closeBtn = element.querySelector('.notification-close');
            closeBtn.addEventListener('click', function() {
                element.style.display = 'none';
                element.className = 'event-notification'; // 重置样式
            });
            
            setTimeout(() => {
                // 只有在通知仍显示时才执行隐藏
                if (element.style.display === 'block') {
                    element.style.display = 'none';
                    element.className = 'event-notification'; // 重置样式
                }
            }, 3000);
            
            // 播放事件音效
            playEventSound(eventType);
        }

        // 显示成就通知
        function showAchievement(achievementName) {
            const element = document.getElementById('achievement');
            element.textContent = '🏆 ' + achievementName;
            element.classList.add('show');
            
            setTimeout(() => {
                element.classList.remove('show');
            }, 3000);
            
            // 播放成就音效
            playAchievementSound();
        }

        // 成就系统
        function checkAchievements() {
            if (!achievements.firstVisit) {
                achievements.firstVisit = true;
                showAchievement('初来乍到');
                unlockAchievementBadge('first-visit');
            }
            
            if (totalIncome >= 1000000 && !achievements.millionaire) {
                achievements.millionaire = true;
                showAchievement('百万富翁');
                unlockAchievementBadge('millionaire');
                // 百万富翁奖励
                hourlyRate += 100;
                showEventNotification('💰 百万富翁奖励：+100 金币/小时', 'achievement');
            }
            
            if (collectedCoins >= 1000 && !achievements.clickMaster) {
                achievements.clickMaster = true;
                showAchievement('手速达人');
                unlockAchievementBadge('click-master');
                // 手速达人奖励
                comboMultiplier += 0.5;
                showEventNotification('⚡ 手速达人奖励：连击倍率 +0.5', 'achievement');
            }
            
            // 等级相关成就
            if (playerLevel >= 10 && !achievements.level10) {
                achievements.level10 = true;
                showAchievement('摸鱼大师');
                unlockAchievementBadge('level-10');
                // 摸鱼大师奖励
                healthLossPerMiss *= 0.8; // 减少失误扣血
                showEventNotification('🎯 摸鱼大师奖励：失误扣血 -20%', 'achievement');
            }
            
            if (playerLevel >= 50 && !achievements.level50) {
                achievements.level50 = true;
                showAchievement('摸鱼传奇');
                unlockAchievementBadge('level-50');
                // 摸鱼传奇奖励
                powerUpSpawnChance *= 1.5; // 增加道具生成概率
                showEventNotification('✨ 摸鱼传奇奖励：道具生成概率 +50%', 'achievement');
            }
            
            // 连击成就
            if (gameStats.maxCombo >= 50 && !achievements.combo50) {
                achievements.combo50 = true;
                showAchievement('连击大师');
                unlockAchievementBadge('combo-50');
                // 连击大师奖励
                comboMultiplier += 1.0;
                showEventNotification('🔥 连击大师奖励：连击倍率 +1.0', 'achievement');
            }
            
            // 完美点击成就
            if (gameStats.perfectClicks >= 100 && !achievements.perfect100) {
                achievements.perfect100 = true;
                showAchievement('完美主义');
                unlockAchievementBadge('perfect-100');
                // 完美主义奖励
                perfectClickBonus += 0.5;
                showEventNotification('💎 完美主义奖励：完美点击加成 +0.5', 'achievement');
            }
            
            // 道具相关成就
            if (gameStats.powerUpsCollected >= 50 && !achievements.powerUpCollector) {
                achievements.powerUpCollector = true;
                showAchievement('道具收藏家');
                unlockAchievementBadge('powerup-collector');
                // 道具收藏家奖励
                powerUpDuration *= 1.3; // 延长道具持续时间
                showEventNotification('🎁 道具收藏家奖励：道具持续时间 +30%', 'achievement');
            }
            
            // 生存成就
            if (gameStats.gamesSurvived >= 10 && !achievements.survivor) {
                achievements.survivor = true;
                showAchievement('生存专家');
                unlockAchievementBadge('survivor');
                // 生存专家奖励
                maxHealth += 20;
                playerHealth = maxHealth;
                showEventNotification('❤️ 生存专家奖励：最大生命值 +20', 'achievement');
                
                // 立即应用生命值提升
                updateHealthBar();
            }
        }
        
        // 解锁成就徽章
        function unlockAchievementBadge(achievementId) {
            const badge = document.getElementById(achievementId);
            if (badge) {
                badge.classList.add('unlocked');
                badge.classList.add('animate-unlock');
                
                // 创建成就解锁动画
                createAchievementUnlockAnimation(achievementId);
                
                // 播放成就音效
                playAchievementSound();
                
                setTimeout(() => {
                    badge.classList.remove('animate-unlock');
                }, 2000);
            }
        }

        function createAchievementUnlockAnimation(achievementId) {
            const achievementNames = {
                'first-visit': '初来乍到',
                'millionaire': '百万富翁',
                'click-master': '手速达人',
                'level-10': '摸鱼大师',
                'level-50': '摸鱼传奇',
                'combo-50': '连击大师',
                'perfect-100': '完美主义',
                'consistent-7days': '持之以恒',
                'powerup-collector': '道具收藏家',
                'survivor': '生存专家'
            };

            const achievementName = achievementNames[achievementId] || '神秘成就';
            
            // 创建成就解锁通知
            const notification = document.createElement('div');
            notification.className = 'achievement-unlock-notification';
            notification.innerHTML = `
                <div class="achievement-icon">🏆</div>
                <div class="achievement-content">
                    <div class="achievement-title">成就解锁！</div>
                    <div class="achievement-name">${achievementName}</div>
                </div>
                <div class="achievement-sparkles">✨</div>
            `;
            
            document.body.appendChild(notification);
            
            // 添加动画类
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // 3秒后移除
            setTimeout(() => {
                notification.classList.add('hide');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
            
            // 创建粒子效果
            createAchievementParticles();
        }

        function createAchievementParticles() {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'achievement-particle';
                particle.style.left = '50%';
                particle.style.top = '20%';
                particle.style.backgroundColor = ['#FFD700', '#FFA500', '#FF6B6B', '#4ECDC4'][Math.floor(Math.random() * 4)];
                
                document.body.appendChild(particle);
                
                // 随机方向和速度
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 100 + 50;
                const lifetime = Math.random() * 1000 + 1000;
                
                particle.style.setProperty('--vx', Math.cos(angle) * velocity + 'px');
                particle.style.setProperty('--vy', Math.sin(angle) * velocity + 'px');
                particle.style.setProperty('--lifetime', lifetime + 'ms');
                
                setTimeout(() => {
                    document.body.removeChild(particle);
                }, lifetime);
            }
        }

        // 音效函数
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playCoinSound() {
            if (!soundEnabled) return;
            initAudioContext();
            
            // 根据金币类型播放不同音效
            let frequency, duration, type;
            
            switch (this.type) {
                case 'diamond':
                    frequency = [1000, 1400]; // 高频清脆音效
                    duration = 0.3;
                    type = 'sine';
                    break;
                case 'rainbow':
                    frequency = [600, 1200, 800]; // 彩虹音阶
                    duration = 0.4;
                    type = 'triangle';
                    break;
                case 'golden':
                    frequency = [800, 1000]; // 温暖音效
                    duration = 0.25;
                    type = 'sine';
                    break;
                default:
                    frequency = [800, 1200];
                    duration = 0.2;
                    type = 'square';
                    break;
            }
            
            // 创建复合音效
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator1.connect(filter);
            oscillator2.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // 设置滤波器
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(2000, audioContext.currentTime);
            
            // 主音调
            oscillator1.frequency.setValueAtTime(frequency[0], audioContext.currentTime);
            oscillator1.type = type;
            
            // 和声
            if (frequency.length > 1) {
                oscillator2.frequency.setValueAtTime(frequency[1], audioContext.currentTime);
                oscillator2.type = type;
            }
            
            // 音量包络
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator1.start(audioContext.currentTime);
            oscillator2.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + duration);
            oscillator2.stop(audioContext.currentTime + duration);
        }

        function playAchievementSound() {
            if (!soundEnabled) return;
            initAudioContext();
            
            // 创建和弦音效
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const oscillator3 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator1.connect(filter);
            oscillator2.connect(filter);
            oscillator3.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // 设置滤波器
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(1000, audioContext.currentTime);
            filter.Q.setValueAtTime(5, audioContext.currentTime);
            
            // C大调和弦 (C-E-G)
            const now = audioContext.currentTime;
            oscillator1.frequency.setValueAtTime(523.25, now); // C5
            oscillator2.frequency.setValueAtTime(659.25, now); // E5
            oscillator3.frequency.setValueAtTime(783.99, now); // G5
            
            oscillator1.type = 'sine';
            oscillator2.type = 'sine';
            oscillator3.type = 'sine';
            
            // 音量包络
            gainNode.gain.setValueAtTime(0.2, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.8);
            
            oscillator1.start(now);
            oscillator2.start(now);
            oscillator3.start(now);
            oscillator1.stop(now + 0.8);
            oscillator2.stop(now + 0.8);
            oscillator3.stop(now + 0.8);
        }
        
        function playLevelUpSound() {
            if (!soundEnabled) return;
            initAudioContext();
            
            // 升级音效 - 上升的琶音
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const oscillator3 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator1.connect(filter);
            oscillator2.connect(filter);
            oscillator3.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // 设置滤波器
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(2000, audioContext.currentTime);
            
            const now = audioContext.currentTime;
            
            // 琶音效果 - 依次播放音符
            const notes = [440, 554, 659, 880]; // A4-C#5-E5-A5
            
            notes.forEach((freq, index) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(filter);
                
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(freq, now + index * 0.1);
                
                gain.gain.setValueAtTime(0.3, now + index * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, now + index * 0.1 + 0.3);
                
                osc.start(now + index * 0.1);
                osc.stop(now + index * 0.1 + 0.3);
            });
            
            // 主音调持续
            oscillator1.frequency.setValueAtTime(440, now);
            oscillator1.type = 'sine';
            oscillator1.frequency.exponentialRampToValueAtTime(880, now + 0.6);
            
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.8);
            
            oscillator1.start(now);
            oscillator1.stop(now + 0.8);
        }

        function playEventSound(eventType = 'default') {
            if (!soundEnabled) return;
            initAudioContext();
            
            // 根据事件类型播放不同音效
            let frequency, duration, oscillatorType, volume;
            
            switch (eventType) {
                case 'paidRestroom':
                    frequency = [300, 350, 400]; // 轻松愉快
                    duration = 0.4;
                    oscillatorType = 'sine';
                    volume = 0.15;
                    break;
                case 'colleagueBlame':
                    frequency = [200, 180, 160]; // 下降音调，表示麻烦
                    duration = 0.5;
                    oscillatorType = 'sawtooth';
                    volume = 0.2;
                    break;
                case 'slackerKing':
                    frequency = [500, 600, 800, 1000]; // 胜利音阶
                    duration = 0.6;
                    oscillatorType = 'square';
                    volume = 0.25;
                    break;
                default:
                    frequency = [400];
                    duration = 0.3;
                    oscillatorType = 'sawtooth';
                    volume = 0.1;
                    break;
            }
            
            // 创建复合音效
            const oscillators = [];
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            // 设置滤波器
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(1500, audioContext.currentTime);
            filter.Q.setValueAtTime(2, audioContext.currentTime);
            
            gainNode.connect(filter);
            filter.connect(audioContext.destination);
            
            // 创建多个振荡器
            frequency.forEach((freq, index) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(filter);
                
                osc.frequency.setValueAtTime(freq, audioContext.currentTime + index * 0.1);
                osc.type = oscillatorType;
                
                gain.gain.setValueAtTime(volume / frequency.length, audioContext.currentTime + index * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                osc.start(audioContext.currentTime + index * 0.1);
                osc.stop(audioContext.currentTime + duration);
                
                oscillators.push(osc);
            });
        }

        function startBGM() {
            if (!bgmEnabled || bgmOscillator) return;
            initAudioContext();
            
            // 创建背景音乐合成器
            bgmOscillator = audioContext.createOscillator();
            bgmGain = audioContext.createGain();
            bgmFilter = audioContext.createBiquadFilter();
            
            bgmOscillator.connect(bgmFilter);
            bgmFilter.connect(bgmGain);
            bgmGain.connect(audioContext.destination);
            
            // 设置滤波器
            bgmFilter.type = 'lowpass';
            bgmFilter.frequency.setValueAtTime(800, audioContext.currentTime);
            bgmFilter.Q.setValueAtTime(1, audioContext.currentTime);
            
            // 设置基础音调
            bgmOscillator.type = 'sine';
            bgmOscillator.frequency.setValueAtTime(220, audioContext.currentTime); // A3
            bgmGain.gain.setValueAtTime(0.05, audioContext.currentTime);
            
            bgmOscillator.start();
            
            // 创建旋律模式
            playBGMPattern();
        }
        
        function playBGMPattern() {
            if (!bgmEnabled || !bgmOscillator) return;
            
            const patterns = [
                [220, 247, 262, 294], // C大调和弦
                [330, 370, 392, 440], // G大调和弦
                [294, 330, 349, 392], // D小调和弦
                [262, 294, 311, 349]  // E小调和弦
            ];
            
            const currentPattern = patterns[bgmPattern % patterns.length];
            let noteIndex = 0;
            
            // 清除之前的间隔
            if (bgmInterval) {
                clearInterval(bgmInterval);
            }
            
            bgmInterval = setInterval(() => {
                if (!bgmEnabled || !bgmOscillator) {
                    clearInterval(bgmInterval);
                    return;
                }
                
                const frequency = currentPattern[noteIndex % currentPattern.length];
                const time = audioContext.currentTime;
                
                // 平滑的频率转换
                bgmOscillator.frequency.setValueAtTime(frequency, time);
                
                // 添加轻微的滤波器调制
                bgmFilter.frequency.setValueAtTime(800 + Math.sin(time * 0.5) * 200, time);
                
                noteIndex++;
                
                // 每4个音符切换到下一个模式
                if (noteIndex % 4 === 0) {
                    bgmPattern = (bgmPattern + 1) % patterns.length;
                }
            }, 500); // 每500毫秒一个音符
        }

        function stopBGM() {
            if (bgmInterval) {
                clearInterval(bgmInterval);
                bgmInterval = null;
            }
            
            if (bgmOscillator) {
                bgmOscillator.stop();
                bgmOscillator = null;
                bgmGain = null;
                bgmFilter = null;
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const button = document.getElementById('soundToggle');
            button.classList.toggle('active', soundEnabled);
            button.textContent = soundEnabled ? '🔊 音效' : '🔇 音效';
        }

        function toggleBGM() {
            bgmEnabled = !bgmEnabled;
            const button = document.getElementById('bgmToggle');
            button.classList.toggle('active', bgmEnabled);
            button.textContent = bgmEnabled ? '🎵 音乐' : '🔇 音乐';
            
            if (bgmEnabled) {
                startBGM();
            } else {
                stopBGM();
            }
        }

        // 更新统计
        function updateStats() {
            const totalHours = (Date.now() - startTime) / (1000 * 60 * 60);
            document.getElementById('totalTime').textContent = totalHours.toFixed(1) + '小时';
            document.getElementById('historicalIncome').textContent = '¥' + totalIncome.toFixed(2);
            document.getElementById('dataTotalIncome').textContent = '¥' + totalIncome.toFixed(2);
            document.getElementById('avgEfficiency').textContent = '99.9%';
            document.getElementById('milkTeaCount').textContent = Math.floor(totalIncome / 25) + '杯';
        }

        // 控制函数
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function toggleStats() {
            const panel = document.getElementById('statsPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            if (panel.style.display === 'block') {
                updateStats();
            }
        }

        function togglePause() {
            isPaused = !isPaused;
            document.body.classList.toggle('paused', isPaused);
            
            // 更新暂停按钮文本和样式
            const pauseBtn = document.querySelector('.control-btn[onclick="togglePause()"]');
            if (pauseBtn) {
                pauseBtn.innerHTML = isPaused ? '▶️ 继续' : '⏸️ 暂停';
                pauseBtn.style.background = isPaused ? 
                    'linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%)' : 
                    'linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 215, 0, 0.1) 100%)';
            }
            
            // 显示暂停状态通知
            showEventNotification(isPaused ? '⏸️ 摸鱼暂停' : '▶️ 继续摸鱼');
            
            if (isPaused) {
                // 停止所有游戏循环定时器
                for (let key in gameIntervals) {
                    clearInterval(gameIntervals[key]);
                }
                
                // 停止动画
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            } else {
                // 重启所有游戏循环定时器
                gameIntervals.generateCoins = setInterval(generateCoins, 1000);
                gameIntervals.updateIncome = setInterval(updateIncome, 1000);
                gameIntervals.triggerSpecialEvent = setInterval(triggerSpecialEvent, 30000);
                gameIntervals.saveData = setInterval(saveData, 10000);
                gameIntervals.updatePlayTime = setInterval(updatePlayTime, 60000);
                
                // 重启挑战计时器
                if (challengeUpdateInterval) clearInterval(challengeUpdateInterval);
                updateChallengeTimer();
                challengeUpdateInterval = setInterval(updateChallengeTimer, 1000);
                gameIntervals.challengeTimer = challengeUpdateInterval;
                
                // 如果恢复游戏，重置开始时间以避免收入跳跃
                startTime = Date.now() - (totalPlayTime * 60 * 1000);
                
                // 重启动画
                animate();
            }
        }

        // 老板模式音效
        function playBossModeSound() {
            if (!soundEnabled) return;
            
            initAudioContext();
            
            const now = audioContext.currentTime;
            
            // 创建专业感的音效 - 类似Excel打开的声音
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator1.connect(filter);
            oscillator2.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // 设置滤波器
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(800, now);
            filter.Q.setValueAtTime(1, now);
            
            // 主音调 - 专业感
            oscillator1.type = 'sine';
            oscillator1.frequency.setValueAtTime(440, now);
            oscillator1.frequency.exponentialRampToValueAtTime(880, now + 0.2);
            
            // 和声
            oscillator2.type = 'sine';
            oscillator2.frequency.setValueAtTime(660, now);
            oscillator2.frequency.exponentialRampToValueAtTime(1320, now + 0.2);
            
            // 音量包络
            gainNode.gain.setValueAtTime(0, now);
            gainNode.gain.linearRampToValueAtTime(0.1, now + 0.05);
            gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
            
            oscillator1.start(now);
            oscillator2.start(now);
            oscillator1.stop(now + 0.3);
            oscillator2.stop(now + 0.3);
        }

        // 随机数据动画变量
        let dataAnimationInterval = null;
        let activeCells = new Set();

        // 开始随机数据动画
        function startRandomDataAnimation() {
            // 清除之前的动画
            stopRandomDataAnimation();
            
            // 创建随机数据更新效果
            dataAnimationInterval = setInterval(() => {
                const cells = document.querySelectorAll('.excel-cell:not(.excel-cell-header)');
                if (cells.length === 0) return;
                
                // 随机选择几个单元格
                const numCellsToUpdate = Math.floor(Math.random() * 3) + 1;
                const selectedCells = [];
                
                for (let i = 0; i < numCellsToUpdate; i++) {
                    const randomCell = cells[Math.floor(Math.random() * cells.length)];
                    if (randomCell && !selectedCells.includes(randomCell)) {
                        selectedCells.push(randomCell);
                    }
                }
                
                selectedCells.forEach(cell => {
                    // 添加选中效果
                    cell.classList.add('selected');
                    activeCells.add(cell);
                    
                    // 随机更新数值（如果是数值单元格）
                    if (cell.textContent.includes('¥')) {
                        const currentValue = parseInt(cell.textContent.replace(/[¥,]/g, ''));
                        if (!isNaN(currentValue)) {
                            const variation = Math.floor(Math.random() * 2000) - 1000;
                            const newValue = Math.max(0, currentValue + variation);
                            cell.textContent = `¥${newValue.toLocaleString()}`;
                        }
                    }
                    
                    // 移除选中效果
                    setTimeout(() => {
                        cell.classList.remove('selected');
                        activeCells.delete(cell);
                    }, 500);
                });
            }, 2000);
        }

        // 停止随机数据动画
        function stopRandomDataAnimation() {
            if (dataAnimationInterval) {
                clearInterval(dataAnimationInterval);
                dataAnimationInterval = null;
            }
            
            // 清除所有选中状态
            activeCells.forEach(cell => {
                cell.classList.remove('selected');
            });
            activeCells.clear();
        }

        function saveSettings() {
            hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 50;
            saveData();
            showEventNotification('设置已保存！');
            toggleSettings();
        }

        // 查看总收入功能
        function showTotalIncome() {
            console.log('=== 查看总收入功能 ===');
            console.log('1. 查看总收入按钮被点击');
            
            // 获取总收入数据
            const totalIncomeElement = document.getElementById('dataTotalIncome');
            const currentRateElement = document.getElementById('dataCurrentRate');
            const onlineTimeElement = document.getElementById('dataOnlineTime');
            
            if (!totalIncomeElement) {
                console.error('❌ 未找到总收入元素');
                alert('无法获取总收入数据');
                return;
            }
            
            const totalIncome = totalIncomeElement.textContent;
            const currentRate = currentRateElement ? currentRateElement.textContent : '¥ 0.00 / 分钟';
            const onlineTime = onlineTimeElement ? onlineTimeElement.textContent : '00:00:00';
            
            console.log('✅ 当前总收入:', totalIncome);
            console.log('✅ 当前速率:', currentRate);
            console.log('✅ 在线时长:', onlineTime);
            
            // 创建总收入详情弹窗
            const incomeModal = document.createElement('div');
            incomeModal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                z-index: 10000;
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
                border: 2px solid rgba(255, 215, 0, 0.8);
                font-family: Arial, sans-serif;
                min-width: 300px;
            `;
            
            incomeModal.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">💰</div>
                    <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px; color: #ffd700;">收入详情</div>
                </div>
                <div style="text-align: left; margin-bottom: 25px;">
                    <div style="margin-bottom: 15px; font-size: 18px;">
                        <strong>💵 今日总收入:</strong> 
                        <span style="color: #ffd700; font-weight: bold;">${totalIncome}</span>
                    </div>
                    <div style="margin-bottom: 15px; font-size: 16px;">
                        <strong>⚡ 当前速率:</strong> 
                        <span style="color: #87ceeb;">${currentRate}</span>
                    </div>
                    <div style="margin-bottom: 15px; font-size: 16px;">
                        <strong>⏱️ 在线时长:</strong> 
                        <span style="color: #98fb98;">${onlineTime}</span>
                    </div>
                </div>
                <button style="
                    background: linear-gradient(45deg, #ff6b6b, #ffa500);
                    color: white;
                    border: none;
                    padding: 12px 24px;
                    border-radius: 25px;
                    font-size: 16px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
                " onclick="this.parentElement.remove()">关闭</button>
            `;
            
            document.body.appendChild(incomeModal);
            
            // 添加动画效果
            incomeModal.style.animation = 'fadeIn 0.3s ease';
            
            showEventNotification('💰 收入详情已显示');
            console.log('2. ✅ 收入详情弹窗已创建并显示');
            console.log('=== 查看总收入功能完成 ===');
        }

        // 关闭数据面板功能
        function closeDataPanel() {
            console.log('=== 关闭数据面板功能 ===');
            console.log('1. 关闭按钮被点击');
            
            // 获取中央数据面板（显示"💰 摸鱼金币 💰"标题的区域）
            const dataPanel = document.querySelector('.data-panel');
            
            if (!dataPanel) {
                console.error('❌ 未找到数据面板');
                alert('未找到数据面板');
                return;
            }
            
            console.log('✅ 找到数据面板:', dataPanel);
            console.log('2. 当前显示状态:', window.getComputedStyle(dataPanel).display);
            
            try {
                // 检查数据面板当前状态
                const isCurrentlyHidden = window.getComputedStyle(dataPanel).display === 'none';
                
                if (isCurrentlyHidden) {
                    console.log('3. 数据面板已经是隐藏状态，显示它');
                    dataPanel.style.display = 'block';
                    showEventNotification('🪙 数据面板已显示');
                    console.log('4. ✅ 数据面板已恢复显示');
                } else {
                    console.log('3. 数据面板当前是显示状态，隐藏它');
                    dataPanel.style.display = 'none';
                    showEventNotification('🪙 数据面板已关闭');
                    console.log('4. ✅ 数据面板已关闭');
                }
                
                console.log('=== 关闭数据面板功能完成 ===');
                
            } catch (error) {
                console.error('❌ 关闭数据面板功能出错:', error);
                alert('关闭数据面板失败: ' + error.message);
                showEventNotification('❌ 关闭数据面板失败');
                console.log('=== 关闭数据面板功能失败 ===');
            }
        }

        // 关闭生命值系统功能
        function closeHealthSystem() {
            console.log('=== 关闭生命值系统功能 ===');
            console.log('1. 生命值关闭按钮被点击');
            
            // 获取所有生命值系统元素
            const healthSystems = document.querySelectorAll('.health-system');
            
            if (healthSystems.length === 0) {
                console.error('❌ 未找到生命值系统');
                alert('未找到生命值系统');
                return;
            }
            
            console.log('✅ 找到生命值系统数量:', healthSystems.length);
            
            try {
                // 隐藏所有生命值系统
                healthSystems.forEach(system => {
                    system.style.display = 'none';
                    console.log('✅ 生命值系统已关闭:', system);
                });
                
                showEventNotification('❤️ 所有生命值显示已关闭');
                console.log('3. ✅ 所有生命值系统已关闭');
                console.log('=== 关闭生命值系统功能完成 ===');
                
            } catch (error) {
                console.error('❌ 关闭生命值系统功能出错:', error);
                alert('关闭生命值系统失败: ' + error.message);
                showEventNotification('❌ 关闭生命值系统失败');
                console.log('=== 关闭生命值系统功能失败 ===');
            }
        }

        // 最小化功能 - 隐藏/显示中央数据面板（"摸鱼金币"标题区域）
        function toggleMiniMode() {
            console.log('=== 数据面板最小化功能 ===');
            console.log('1. 最小化按钮被点击');
            
            // 获取中央数据面板（显示"💰 摸鱼金币 💰"标题的区域）
            const dataPanel = document.querySelector('.data-panel');
            const statsGrid = document.querySelector('.stats-grid');
            const levelSystem = document.querySelector('.level-system');
            const achievementPanel = document.querySelector('.achievement-panel');
            
            if (!dataPanel) {
                console.error('❌ 未找到数据面板');
                alert('未找到数据面板');
                return;
            }
            
            console.log('✅ 找到数据面板:', dataPanel);
            console.log('2. 当前显示状态:', window.getComputedStyle(dataPanel).display);
            
            try {
                // 检查数据面板当前状态
                const isCurrentlyHidden = window.getComputedStyle(dataPanel).display === 'none';
                
                if (isCurrentlyHidden) {
                    console.log('3. 数据面板当前是隐藏状态，显示它');
                    
                    // 显示数据面板和相关元素
                    dataPanel.style.display = 'block';
                    if (statsGrid) statsGrid.style.display = 'grid';
                    if (levelSystem) levelSystem.style.display = 'flex';
                    if (achievementPanel) achievementPanel.style.display = 'block';
                    
                    // 移除最小化提示
                    const miniIndicator = document.getElementById('miniModeIndicator');
                    if (miniIndicator) {
                        miniIndicator.remove();
                    }
                    
                    showEventNotification('🪙 数据面板已显示');
                    console.log('4. ✅ 数据面板已恢复显示');
                    
                } else {
                    console.log('3. 数据面板当前是显示状态，隐藏它');
                    
                    // 隐藏数据面板和相关元素
                    dataPanel.style.display = 'none';
                    if (statsGrid) statsGrid.style.display = 'none';
                    if (levelSystem) levelSystem.style.display = 'none';
                    if (achievementPanel) achievementPanel.style.display = 'none';
                    
                    // 创建最小化提示
                    const miniIndicator = document.createElement('div');
                    miniIndicator.id = 'miniModeIndicator';
                    miniIndicator.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 20px 30px;
                        border-radius: 15px;
                        text-align: center;
                        z-index: 10000;
                        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
                        border: 2px solid rgba(255, 215, 0, 0.8);
                        font-family: Arial, sans-serif;
                        cursor: pointer;
                    `;
                    
                    miniIndicator.innerHTML = `
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">🪙</div>
                            <div style="font-size: 20px; font-weight: bold; margin-bottom: 5px;">摸鱼金币</div>
                            <div style="font-size: 14px; opacity: 0.9;">数据面板已最小化</div>
                        </div>
                        <div style="font-size: 12px; opacity: 0.7;">点击此处恢复显示</div>
                    `;
                    
                    // 添加点击恢复功能
                    miniIndicator.onclick = function() {
                        toggleMiniMode();
                    };
                    
                    document.body.appendChild(miniIndicator);
                    
                    showEventNotification('🪙 数据面板已最小化');
                    console.log('4. ✅ 数据面板已隐藏，显示最小化提示');
                }
                
                console.log('=== 数据面板最小化功能完成 ===');
                
            } catch (error) {
                console.error('❌ 数据面板最小化功能出错:', error);
                alert('数据面板最小化失败: ' + error.message);
                showEventNotification('❌ 数据面板最小化失败');
                console.log('=== 数据面板最小化功能失败 ===');
            }
        }
        
        // 降级方案：窗口最小化回退
        function minimizeWindowFallback() {
            console.log('执行最小化回退方案');
            
            const gameContainer = document.querySelector('.main-container');
            if (!gameContainer) {
                console.log('未找到gameContainer');
                return;
            }
            
            // 保存原始显示状态
            const originalDisplay = gameContainer.style.display || 'block';
            console.log('原始显示状态:', originalDisplay);
            
            // 确保游戏容器有明确的显示状态
            if (originalDisplay === 'none') {
                console.log('游戏容器当前已经是隐藏状态，直接显示最小化提示');
            }
            
            // 移除已存在的最小化提示
            const existingIndicator = document.getElementById('minimizeIndicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
            
            // 创建简化的最小化提示
            const minimizeIndicator = document.createElement('div');
            minimizeIndicator.id = 'minimizeIndicator';
            minimizeIndicator.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                z-index: 10000;
                backdrop-filter: blur(10px);
                border: 2px solid rgba(255, 215, 0, 0.5);
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            `;
            minimizeIndicator.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                    <div style="font-size: 48px;">🪙</div>
                    <div style="font-size: 18px; font-weight: bold; color: #ffd700;">摸鱼金币已最小化</div>
                    <button style="
                        background: linear-gradient(45deg, #ff6b6b, #ffa500);
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 25px;
                        font-size: 16px;
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
                    " onclick="restoreFromMinimize()">恢复窗口</button>
                </div>
            `;
            
            // 确保bounce动画存在
            if (!document.querySelector('style[data-bounce-animation]')) {
                addBounceAnimation();
            }
            
            // 添加简单的闪烁效果
            const coinIcon = minimizeIndicator.querySelector('div[style*="font-size: 48px"]');
            if (coinIcon) {
                let flashCount = 0;
                const flashInterval = setInterval(() => {
                    coinIcon.style.opacity = coinIcon.style.opacity === '0.5' ? '1' : '0.5';
                    flashCount++;
                    if (flashCount >= 6) {
                        clearInterval(flashInterval);
                        coinIcon.style.opacity = '1';
                    }
                }, 500);
            }
            
            document.body.appendChild(minimizeIndicator);
            console.log('最小化提示已创建');
            
            // 隐藏主界面
            gameContainer.style.display = 'none';
            console.log('主界面已隐藏');
            
            showEventNotification('🪙 摸鱼金币窗口已最小化');
        }
        
        // 恢复窗口函数（全局可访问）
        function restoreFromMinimize() {
            console.log('恢复窗口');
            const gameContainer = document.querySelector('.main-container');
            const minimizeIndicator = document.getElementById('minimizeIndicator');
            
            if (gameContainer) {
                gameContainer.style.display = 'block';
            }
            
            if (minimizeIndicator) {
                minimizeIndicator.remove();
            }
            
            showEventNotification('🪙 摸鱼金币窗口已恢复');
        }
        
        // 添加bounce动画样式
        function addBounceAnimation() {
            const style = document.createElement('style');
            style.setAttribute('data-bounce-animation', 'true');
            style.textContent = `
                @keyframes bounce {
                    0%, 20%, 50%, 80%, 100% {
                        transform: translateY(0);
                    }
                    40% {
                        transform: translateY(-10px);
                    }
                    60% {
                        transform: translateY(-5px);
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        // 显示简化信息条
        function showMiniInfoBar() {
            const miniBar = document.createElement('div');
            miniBar.id = 'miniInfoBar';
            miniBar.className = 'mini-info-bar';
            miniBar.innerHTML = `
                <div class="mini-info-item">
                    <span class="mini-label">收入:</span>
                    <span class="mini-value" id="miniTotalIncome">¥0.00</span>
                </div>
                <div class="mini-info-item">
                    <span class="mini-label">速率:</span>
                    <span class="mini-value" id="miniCurrentRate">¥0.00/分</span>
                </div>
                <div class="mini-info-item">
                    <span class="mini-label">时长:</span>
                    <span class="mini-value" id="miniOnlineTime">00:00</span>
                </div>
            `;
            document.body.appendChild(miniBar);
            
            // 更新简化信息条数据
            updateMiniInfoBar();
        }
        
        // 隐藏简化信息条
        function hideMiniInfoBar() {
            const miniBar = document.getElementById('miniInfoBar');
            if (miniBar) {
                miniBar.remove();
            }
        }
        
        // 更新简化信息条（已废弃，保留兼容性）
        function updateMiniInfoBar() {
            // 此功能已移除，不再更新最小化信息条
        }
        
        // 老板键功能
        function toggleBossMode() {
            isBossMode = !isBossMode;
            const bossScreen = document.getElementById('bossScreen');
            const bossModeHint = document.getElementById('bossModeHint');
            
            if (isBossMode) {
                bossScreen.style.display = 'block';
                bossScreen.classList.add('active');
                showEventNotification('老板键激活！安全第一！');
                
                // 播放老板模式音效
                if (soundEnabled) {
                    playBossModeSound();
                }
                
                // 添加随机数据更新动画
                startRandomDataAnimation();
                updateExcelTime();
                
                // 显示提示
                setTimeout(() => {
                    bossModeHint.classList.add('show');
                    setTimeout(() => {
                        bossModeHint.classList.remove('show');
                    }, 2000);
                }, 500);
                
                // 隐藏游戏元素
                document.querySelector('.controls').style.opacity = '0';
                document.querySelector('.sound-controls').style.opacity = '0';
                document.getElementById('coinCanvas').style.opacity = '0.1';
                
                // 开始更新时间
                startExcelTimeUpdate();
                
            } else {
                bossScreen.classList.remove('active');
                setTimeout(() => {
                    bossScreen.style.display = 'none';
                }, 300);
                
                // 恢复游戏元素
                document.querySelector('.controls').style.opacity = '1';
                document.querySelector('.sound-controls').style.opacity = '1';
                document.getElementById('coinCanvas').style.opacity = '1';
                
                // 停止数据动画
                stopRandomDataAnimation();
                stopExcelTimeUpdate();
            }
        }

        // Excel时间更新
        let excelTimeInterval;
        
        function updateExcelTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const excelTimeElement = document.getElementById('excelTime');
            if (excelTimeElement) {
                excelTimeElement.textContent = timeString;
            }
        }
        
        function startExcelTimeUpdate() {
            updateExcelTime();
            excelTimeInterval = setInterval(updateExcelTime, 1000);
        }
        
        function stopExcelTimeUpdate() {
            if (excelTimeInterval) {
                clearInterval(excelTimeInterval);
                excelTimeInterval = null;
            }
        }

        // 键盘事件监听
        document.addEventListener('keydown', function(e) {
            if (e.key === '`' || e.key === ' ') {
                e.preventDefault();
                toggleBossMode();
            }
            
            // 老板模式下的额外快捷键
            if (isBossMode) {
                if (e.key === 'Escape') {
                    e.preventDefault();
                    toggleBossMode();
                }
                
                // 模拟Excel快捷键
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 's':
                            e.preventDefault();
                            showFakeSaveAnimation();
                            break;
                        case 'c':
                        case 'v':
                            e.preventDefault();
                            showFakeCopyAnimation();
                            break;
                        case 'z':
                            e.preventDefault();
                            showFakeUndoAnimation();
                            break;
                    }
                }
            }
        });

        // 模拟Excel操作动画
        function showFakeSaveAnimation() {
            const statusBar = document.querySelector('.excel-status-bar');
            const originalText = statusBar.querySelector('span').textContent;
            statusBar.querySelector('span').textContent = '正在保存...';
            
            setTimeout(() => {
                statusBar.querySelector('span').textContent = '保存完成';
                setTimeout(() => {
                    statusBar.querySelector('span').textContent = originalText;
                }, 1000);
            }, 800);
        }
        
        function showFakeCopyAnimation() {
            const hint = document.createElement('div');
            hint.className = 'excel-hint';
            hint.textContent = '已复制到剪贴板';
            hint.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                font-size: 12px;
                z-index: 2000;
                pointer-events: none;
                animation: fadeInOut 1.5s ease;
            `;
            
            document.body.appendChild(hint);
            setTimeout(() => {
                if (hint.parentNode) {
                    hint.parentNode.removeChild(hint);
                }
            }, 1500);
        }
        
        function showFakeUndoAnimation() {
            const cells = document.querySelectorAll('.excel-cell');
            const randomCell = cells[Math.floor(Math.random() * cells.length)];
            
            if (randomCell) {
                randomCell.style.background = 'rgba(255, 193, 7, 0.3)';
                setTimeout(() => {
                    randomCell.style.background = '';
                }, 500);
            }
        }
        
        // 添加淡入淡出动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                50% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            }
        `;
        document.head.appendChild(style);

        // Excel单元格点击交互
        document.addEventListener('click', function(e) {
            if (isBossMode && e.target.classList.contains('excel-cell')) {
                // 移除之前的选中状态
                document.querySelectorAll('.excel-cell').forEach(cell => {
                    cell.classList.remove('selected');
                });
                
                // 添加选中状态
                e.target.classList.add('selected');
                
                // 更新状态栏
                const statusBar = document.querySelector('.excel-status-bar span');
                if (statusBar) {
                    statusBar.textContent = '就绪';
                }
                
                // 模拟编辑模式
                setTimeout(() => {
                    e.target.classList.remove('selected');
                }, 1000);
            }
        });

        // 添加鼠标悬停效果到Excel行
        const excelRows = document.querySelectorAll('.excel-row');
        excelRows.forEach((row, index) => {
            row.addEventListener('mouseenter', function() {
                if (isBossMode) {
                    // 高亮整行
                    const cells = row.querySelectorAll('.excel-cell');
                    cells.forEach(cell => {
                        cell.style.background = 'rgba(66, 133, 244, 0.1)';
                    });
                    
                    // 显示行号提示
                    const rowHint = document.createElement('div');
                    rowHint.className = 'row-hint';
                    rowHint.textContent = `第 ${index + 1} 行`;
                    rowHint.style.cssText = `
                        position: absolute;
                        left: -60px;
                        top: 50%;
                        transform: translateY(-50%);
                        background: #333;
                        color: white;
                        padding: 4px 8px;
                        border-radius: 3px;
                        font-size: 11px;
                        z-index: 1000;
                        pointer-events: none;
                        opacity: 0;
                        transition: opacity 0.2s ease;
                    `;
                    
                    row.style.position = 'relative';
                    row.appendChild(rowHint);
                    
                    setTimeout(() => {
                        rowHint.style.opacity = '1';
                    }, 50);
                }
            });
            
            row.addEventListener('mouseleave', function() {
                if (isBossMode) {
                    const cells = row.querySelectorAll('.excel-cell');
                    cells.forEach(cell => {
                        cell.style.background = '';
                    });
                    
                    const rowHint = row.querySelector('.row-hint');
                    if (rowHint) {
                        rowHint.remove();
                    }
                }
            });
        });

        // Canvas点击事件
        document.getElementById('coinCanvas').addEventListener('click', function(e) {
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // 创建点击波纹效果
            createClickRipple(e.clientX, e.clientY);
            
            let coinClicked = false;
            
            // 检查是否点击到金币
            coins.forEach(coin => {
                const distance = Math.sqrt((x - coin.x) ** 2 + (y - coin.y) ** 2);
                if (distance < coin.size / 2 && !coin.collected) {
                    coin.collect();
                    coinClicked = true;
                    totalClicks++;
                    console.log('金币被点击！总点击数：', totalClicks);
                    console.log('准备更新挑战进度...');
                    updateChallengeProgress('click', 1);
                    console.log('挑战进度更新完成');
                    
                    // 立即更新显示，确保实时性
                    updateDisplay();
                    updateStats();
                }
            });
            
            // 总尝试次数增加（无论是否点击到金币）
            totalAttempts++;
            
            // 如果没有点击到金币，显示提示
            if (!coinClicked) {
                showClickHint(e.clientX, e.clientY);
            }
            
            // 更新准确率挑战 - 只有成功点击金币才算作有效点击
            if (coinClicked) {
                updateChallengeProgress('accuracy', 1);
            }
        });

        // 创建点击波纹效果
        function createClickRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.className = 'click-ripple';
            ripple.style.left = (x - 50) + 'px';
            ripple.style.top = (y - 50) + 'px';
            ripple.style.width = '100px';
            ripple.style.height = '100px';
            
            document.body.appendChild(ripple);
            
            setTimeout(() => {
                if (ripple.parentNode) {
                    ripple.parentNode.removeChild(ripple);
                }
            }, 600);
        }

        // 显示点击提示
        function showClickHint(x, y) {
            const hint = document.createElement('div');
            hint.className = 'coin-collect';
            hint.textContent = '点击金币！';
            hint.style.left = x + 'px';
            hint.style.top = y + 'px';
            hint.style.color = '#ff6b6b';
            hint.style.fontSize = '14px';
            
            document.body.appendChild(hint);
            
            setTimeout(() => {
                if (hint.parentNode) {
                    hint.parentNode.removeChild(hint);
                }
            }, 1000);
        }

        // 窗口大小调整
        window.addEventListener('resize', function() {
            const canvas = document.getElementById('coinCanvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // 响应式调整金币大小
            const isMobile = window.innerWidth <= 768;
            coins.forEach(coin => {
                if (isMobile && coin.size > 40) {
                    coin.size = Math.min(coin.size, 35);
                }
            });
        });

        // 鼠标位置跟踪
        let mousePos = { x: 0, y: 0 };
        
        document.addEventListener('mousemove', function(e) {
            mousePos.x = e.clientX;
            mousePos.y = e.clientY;
        });

        // 每日挑战系统
        let dailyChallenges = [];
        let totalClicks = 0;
        let totalAttempts = 0;
        
        // 挑战配置
        const CHALLENGES = [
            {
                id: 'click_100',
                title: '摸鱼新手',
                description: '点击金币达到100次',
                icon: '🎯',
                target: 100,
                reward: 500,
                type: 'click'
            },
            {
                id: 'time_30min',
                title: '时间管理大师',
                description: '累计摸鱼30分钟',
                icon: '⏰',
                target: 30 * 60 * 1000, // 30分钟
                reward: 1000,
                type: 'time'
            },
            {
                id: 'accuracy_80',
                title: '精准点击',
                description: '成功点击金币80次',
                icon: '🎯',
                target: 80,
                reward: 800,
                type: 'accuracy'
            }
        ];

        // 初始化每日挑战
        function initDailyChallenges() {
            const savedChallenges = localStorage.getItem('dailyChallenges');
            const lastUpdate = localStorage.getItem('dailyChallengesLastUpdate');
            const now = new Date().getTime();
            
            console.log('初始化每日挑战 - 保存的挑战:', savedChallenges);
            console.log('初始化每日挑战 - 最后更新:', lastUpdate);
            
            // 检查是否需要重置挑战（每天0点）
            if (!savedChallenges || !lastUpdate || shouldResetChallenges(parseInt(lastUpdate))) {
                console.log('需要重置挑战，创建新的挑战列表');
                dailyChallenges = CHALLENGES.map(challenge => ({
                    ...challenge,
                    progress: 0,
                    completed: false,
                    claimed: false
                }));
                localStorage.setItem('dailyChallenges', JSON.stringify(dailyChallenges));
                localStorage.setItem('dailyChallengesLastUpdate', now);
            } else {
                dailyChallenges = JSON.parse(savedChallenges);
                console.log('加载保存的挑战:', dailyChallenges);
            }
            
            updateChallengeDisplay();
            startChallengeTimer();
            
            // 添加拖拽功能
            makePanelDraggable();
        }

        // 检查是否应该重置挑战
        function shouldResetChallenges(lastUpdate) {
            const lastDate = new Date(lastUpdate);
            const now = new Date();
            return lastDate.getDate() !== now.getDate() || 
                   lastDate.getMonth() !== now.getMonth() || 
                   lastDate.getFullYear() !== now.getFullYear();
        }

        // 更新挑战进度
        function updateChallengeProgress(type, value = 1) {
            let updated = false;
            let completedChallenge = null;
            
            console.log('更新挑战进度 - 类型:', type, '值:', value, '当前挑战:', dailyChallenges);
            
            dailyChallenges.forEach(challenge => {
                if (challenge.type === type && !challenge.completed) {
                    console.log('找到匹配挑战:', challenge.title, '当前进度:', challenge.progress);
                    if (type === 'click') {
                        challenge.progress += value;
                        console.log('点击挑战进度更新:', challenge.progress, '/', challenge.target);
                    } else if (type === 'time') {
                        challenge.progress = Math.min(challenge.progress + value, challenge.target);
                    } else if (type === 'accuracy') {
                        // 精准点击挑战：计算成功点击的累计数量
                        challenge.progress += value;
                        console.log('精准点击挑战进度更新:', challenge.progress, '/', challenge.target);
                    }
                    
                    if (challenge.progress >= challenge.target) {
                        challenge.completed = true;
                        completedChallenge = challenge;
                        showChallengeCompleteNotification(challenge);
                    }
                    
                    updated = true;
                }
            });
            
            if (updated) {
                console.log('挑战进度已更新，保存到本地存储');
                localStorage.setItem('dailyChallenges', JSON.stringify(dailyChallenges));
                updateChallengeDisplay();
                
                // 更新统计面板显示
                updateDisplay();
                
                // 如果有挑战完成，播放特殊音效和动画
                if (completedChallenge) {
                    setTimeout(() => {
                        playAchievementSound();
                        // 显示完成挑战的额外通知
                        showNotification(`🎉 挑战完成: ${completedChallenge.title}! 点击领取奖励`, 'achievement');
                    }, 500);
                }
            }
        }

        // 显示挑战完成通知
        function showChallengeCompleteNotification(challenge) {
            showNotification(`🎉 挑战完成: ${challenge.title}! +${challenge.reward}金币`, 'achievement');
        }

        // 更新挑战显示
        function updateChallengeDisplay() {
            const panel = document.getElementById('dailyChallengesPanel');
            if (!panel.style.display || panel.style.display === 'none') return;
            
            const content = panel.querySelector('.challenges-content');
            content.innerHTML = '';
            
            dailyChallenges.forEach((challenge, index) => {
                const progress = Math.min(challenge.progress, challenge.target);
                const progressPercent = (progress / challenge.target) * 100;
                
                const challengeItem = document.createElement('div');
                challengeItem.className = `challenge-item ${challenge.completed ? 'completed' : ''}`;
                challengeItem.innerHTML = `
                    <div class="challenge-icon">${challenge.icon}</div>
                    <div class="challenge-info">
                        <div class="challenge-title">${challenge.title}</div>
                        <div class="challenge-desc">${challenge.description}</div>
                        <div class="challenge-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div class="progress-text">${Math.floor(progress)}/${challenge.target}</div>
                        </div>
                    </div>
                    <div class="challenge-reward">
                        <div class="reward-amount">${challenge.reward}金币</div>
                        <button class="claim-btn ${challenge.claimed ? 'claimed' : ''} ${challenge.completed && !challenge.claimed ? 'available' : ''}" 
                                onclick="claimChallengeReward(${index})" 
                                ${!challenge.completed || challenge.claimed ? 'disabled' : ''}>
                            ${challenge.claimed ? '已领取' : '领取'}
                        </button>
                    </div>
                `;
                content.appendChild(challengeItem);
            });
            
            // ✅ 新增：同时更新硬编码的HTML元素
            updateHardcodedChallengeElements();
        }
        
        // ✅ 新增：更新硬编码的挑战元素（修复核心问题）
        function updateHardcodedChallengeElements() {
            console.log('🔄 更新硬编码挑战元素...');
            
            dailyChallenges.forEach((challenge, index) => {
                const challengeNum = index + 1;
                const progressText = document.getElementById(`progressText${challengeNum}`);
                const progressBar = document.getElementById(`progress${challengeNum}`);
                const claimBtn = document.getElementById(`claim${challengeNum}`);
                
                if (progressText) {
                    progressText.textContent = `${challenge.progress}/${challenge.target}`;
                }
                
                if (progressBar) {
                    const percentage = Math.min((challenge.progress / challenge.target) * 100, 100);
                    progressBar.style.width = `${percentage}%`;
                }
                
                if (claimBtn) {
                    if (challenge.completed && !challenge.claimed) {
                        claimBtn.disabled = false;
                        claimBtn.classList.add('available');
                        claimBtn.textContent = '领取';
                    } else if (challenge.claimed) {
                        claimBtn.disabled = true;
                        claimBtn.classList.add('claimed');
                        claimBtn.textContent = '已领取';
                    } else {
                        claimBtn.disabled = true;
                        claimBtn.textContent = '领取';
                    }
                }
            });
            
            console.log('✅ 硬编码挑战元素更新完成');
        }
        
        // 添加拖拽功能
        function makePanelDraggable() {
            const panel = document.querySelector('.daily-challenges-panel');
            if (!panel) return;
            
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;
            
            panel.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
            
            function dragStart(e) {
                // 只允许在面板头部拖拽，避免误操作
                const header = panel.querySelector('.challenges-header');
                if (!header || !e.target.closest('.challenges-header')) return;
                
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
                isDragging = true;
                
                // 添加拖拽时的视觉反馈
                panel.style.cursor = 'grabbing';
                panel.style.transition = 'none';
            }
            
            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;
                    
                    panel.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
            }
            
            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                
                // 恢复面板样式
                panel.style.cursor = 'default';
                panel.style.transition = 'all 0.3s ease';
                
                // 限制面板位置，防止拖出屏幕
                const rect = panel.getBoundingClientRect();
                const maxX = window.innerWidth - rect.width;
                const maxY = window.innerHeight - rect.height;
                
                if (currentX < -rect.width + 50) {
                    currentX = -rect.width + 50;
                    xOffset = currentX;
                    panel.style.transform = `translate(${currentX}px, ${currentY}px)`;
                } else if (currentX > maxX - 50) {
                    currentX = maxX - 50;
                    xOffset = currentX;
                    panel.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
                
                if (currentY < 0) {
                    currentY = 0;
                    yOffset = currentY;
                    panel.style.transform = `translate(${currentX}px, ${currentY}px)`;
                } else if (currentY > maxY) {
                    currentY = maxY;
                    yOffset = currentY;
                    panel.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
            }
        }

        // 领取挑战奖励
        function claimChallengeReward(index) {
            const challenge = dailyChallenges[index];
            if (challenge.completed && !challenge.claimed) {
                challenge.claimed = true;
                money += challenge.reward;
                showNotification(`+${challenge.reward}金币奖励已领取!`, 'achievement');
                updateStats();
                localStorage.setItem('dailyChallenges', JSON.stringify(dailyChallenges));
                updateChallengeDisplay();
            }
        }

        // 显示每日挑战面板
        function showDailyChallenges() {
            const panel = document.getElementById('dailyChallengesPanel');
            panel.style.display = 'block';
            updateChallengeDisplay();
            updateChallengeTimer();
            
            // 调试信息
            console.log('显示每日挑战面板 - 当前挑战状态:', dailyChallenges);
        }
        
        // 重置挑战（测试用）
        function resetChallenges() {
            if (confirm('确定要重置所有挑战吗？')) {
                localStorage.removeItem('dailyChallenges');
                localStorage.removeItem('dailyChallengesLastUpdate');
                initDailyChallenges();
                console.log('挑战已重置');
            }
        }

        // 隐藏每日挑战面板
        function hideDailyChallenges() {
            document.getElementById('dailyChallengesPanel').style.display = 'none';
        }

        // 切换每日挑战面板显示状态
        function toggleDailyChallenges() {
            const panel = document.getElementById('dailyChallengesPanel');
            if (panel.style.display === 'none' || panel.style.display === '') {
                showDailyChallenges();
            } else {
                hideDailyChallenges();
            }
        }

        // 更新挑战计时器
        function updateChallengeTimer() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const timeLeft = tomorrow - now;
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            const timerDisplay = document.querySelector('.timer-display');
            if (timerDisplay) {
                timerDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // 启动挑战计时器
        function startChallengeTimer() {
            if (challengeUpdateInterval) clearInterval(challengeUpdateInterval);
            updateChallengeTimer();
            challengeUpdateInterval = setInterval(updateChallengeTimer, 1000);
            gameIntervals.challengeTimer = challengeUpdateInterval; // 存储到游戏定时器对象
        }

        // 初始化
        function init() {
            loadData();
            createStars();
            initCanvas();
            
            // 设置输入框的值
            document.getElementById('hourlyRate').value = hourlyRate;
            
            // 初始化等级系统UI
            updateExperienceBar();
            
            // 启动各种定时器并存储引用
            gameIntervals.generateCoins = setInterval(generateCoins, 1000);
            gameIntervals.updateIncome = setInterval(updateIncome, 1000);
            gameIntervals.triggerSpecialEvent = setInterval(triggerSpecialEvent, 30000); // 每30秒触发一次特殊事件
            gameIntervals.saveData = setInterval(saveData, 10000); // 每10秒保存一次数据
            gameIntervals.updatePlayTime = setInterval(updatePlayTime, 60000); // 每分钟更新游戏时间
            
            // 开始动画
            animate();
            
            // 显示欢迎消息
            setTimeout(() => {
                showEventNotification('🎉 欢迎使用摸鱼金币！开始您的带薪摸鱼之旅！');
            }, 1000);
            
            // 播放启动音效
            if (soundEnabled) {
                setTimeout(() => {
                    playAchievementSound();
                }, 1500);
            }
            
            // 初始化每日挑战
            initDailyChallenges();
            
            // 添加最小化模式样式
            addMiniModeStyles();
        }
        
        // 更新游戏时间
        function updatePlayTime() {
            totalPlayTime++;
            
            // 检查连续游戏成就
            if (totalPlayTime >= 60 && !achievements.consistent7Days) { // 1小时
                // 这里可以添加更复杂的连续游戏逻辑
                // 现在简化为1小时连续游戏
                achievements.consistent7Days = true;
                showAchievement('持之以恒');
                unlockAchievementBadge('consistent-7days');
            }
        }

        // 页面加载完成后初始化
        window.addEventListener('load', init);

        // 排行榜功能
        function showLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            const content = document.getElementById('leaderboardContent');
            
            // 生成模拟排行榜数据
            const leaderboardData = generateLeaderboardData();
            
            content.innerHTML = `
                <div class="leaderboard-header">
                    <h3>🏆 摸鱼排行榜</h3>
                    <div class="leaderboard-stats">
                        <div class="stat-item">
                            <span class="stat-label">总玩家数</span>
                            <span class="stat-value">${leaderboardData.length}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">你的排名</span>
                            <span class="stat-value">#${leaderboardData.findIndex(p => p.isCurrentPlayer) + 1}</span>
                        </div>
                    </div>
                </div>
                <div class="leaderboard-tabs">
                    <button class="tab-btn active" onclick="switchLeaderboardTab('score')">收入排行</button>
                    <button class="tab-btn" onclick="switchLeaderboardTab('level')">等级排行</button>
                    <button class="tab-btn" onclick="switchLeaderboardTab('clicks')">点击排行</button>
                    <button class="tab-btn" onclick="switchLeaderboardTab('accuracy')">精准排行</button>
                </div>
                <div id="leaderboardTabContent"></div>
            `;
            
            // 显示默认排行榜（按分数）
            displayLeaderboardByType('score', leaderboardData);
            
            leaderboard.style.display = 'block';
            
            // 添加显示动画
            leaderboard.style.animation = 'leaderboardSlideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            
            // 播放排行榜打开音效
            playSound('leaderboardOpen');
        }
        
        function switchLeaderboardTab(type) {
            // 更新标签按钮状态
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 重新生成数据并显示
            const leaderboardData = generateLeaderboardData();
            displayLeaderboardByType(type, leaderboardData);
        }
        
        function displayLeaderboardByType(type, data) {
            const content = document.getElementById('leaderboardTabContent');
            let sortedData = [...data];
            
            // 根据类型排序
            switch(type) {
                case 'level':
                    sortedData.sort((a, b) => b.level - a.level);
                    break;
                case 'clicks':
                    sortedData.sort((a, b) => b.clicks - a.clicks);
                    break;
                case 'accuracy':
                    sortedData.sort((a, b) => parseFloat(b.accuracy) - parseFloat(a.accuracy));
                    break;
                default:
                    sortedData.sort((a, b) => b.score - a.score);
            }
            
            content.innerHTML = '';
            sortedData.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                if (player.isCurrentPlayer) {
                    item.classList.add('current-player');
                }
                
                // 为前三名添加特殊样式
                if (index < 3) {
                    const rankElement = item.querySelector('.leaderboard-rank');
                    if (rankElement) {
                        rankElement.classList.add('top-3');
                    }
                }
                
                let displayValue = '';
                let subValue = '';
                
                switch(type) {
                    case 'level':
                        displayValue = `Lv.${player.level}`;
                        subValue = `收入: ¥${player.score.toFixed(2)}`;
                        break;
                    case 'clicks':
                        displayValue = `${player.clicks}次`;
                        subValue = `准确率: ${player.accuracy}%`;
                        break;
                    case 'accuracy':
                        displayValue = `${player.accuracy}%`;
                        subValue = `${player.clicks}次点击`;
                        break;
                    default:
                        displayValue = `¥${player.score.toFixed(2)}`;
                        subValue = `Lv.${player.level} | ${player.clicks}次点击`;
                }
                
                item.innerHTML = `
                    <div class="leaderboard-rank ${index < 3 ? 'top-3' : ''}">#${index + 1}</div>
                    <div class="leaderboard-player-info" onclick="showPlayerProfile('${player.name}', ${JSON.stringify(player).replace(/"/g, '&quot;')})" style="cursor: pointer;">
                        <div class="leaderboard-name">${player.name}</div>
                        <div class="leaderboard-subtitle">${subValue}</div>
                    </div>
                    <div class="leaderboard-value">${displayValue}</div>
                `;
                
                // 添加进入动画
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                content.appendChild(item);
                
                // 延迟显示动画
                setTimeout(() => {
                    item.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }

        function hideLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            const playerProfile = document.getElementById('playerProfile');
            
            // 添加隐藏动画
            leaderboard.style.animation = 'leaderboardSlideOut 0.3s ease-out';
            
            setTimeout(() => {
                leaderboard.style.display = 'none';
                playerProfile.style.display = 'none';
            }, 300);
            
            // 播放排行榜关闭音效
            playSound('leaderboardClose');
        }
        
        function showPlayerProfile(playerName, playerData) {
            const profile = document.getElementById('playerProfile');
            const content = document.getElementById('playerProfileContent');
            
            const playTimeHours = Math.floor(playerData.playTime / 3600);
            const playTimeMinutes = Math.floor((playerData.playTime % 3600) / 60);
            
            content.innerHTML = `
                <div class="profile-header">
                    <div class="profile-avatar">👤</div>
                    <div class="profile-basic-info">
                        <div class="profile-name">${playerName}</div>
                        <div class="profile-level">等级 Lv.${playerData.level}</div>
                        <div class="profile-rank">排名 #${playerData.rank || '未知'}</div>
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="profile-stat">
                        <div class="stat-icon">💰</div>
                        <div class="stat-info">
                            <div class="stat-label">总收入</div>
                            <div class="stat-value">¥${playerData.score.toFixed(2)}</div>
                        </div>
                    </div>
                    <div class="profile-stat">
                        <div class="stat-icon">👆</div>
                        <div class="stat-info">
                            <div class="stat-label">总点击</div>
                            <div class="stat-value">${playerData.clicks}</div>
                        </div>
                   </div>
                    <div class="profile-stat">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-info">
                            <div class="stat-label">准确率</div>
                            <div class="stat-value">${playerData.accuracy}%</div>
                        </div>
                    </div>
                    <div class="profile-stat">
                        <div class="stat-icon">⏱️</div>
                        <div class="stat-info">
                            <div class="stat-label">游戏时长</div>
                            <div class="stat-value">${playTimeHours}h ${playTimeMinutes}m</div>
                        </div>
                    </div>
                    <div class="profile-stat">
                        <div class="stat-icon">🏆</div>
                        <div class="stat-info">
                            <div class="stat-label">成就数</div>
                            <div class="stat-value">${playerData.achievements}</div>
                        </div>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="profile-btn" onclick="hidePlayerProfile()">关闭</button>
                </div>
            `;
            
            profile.style.display = 'block';
            
            // 添加显示动画
            profile.style.animation = 'profileSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            
            // 播放玩家详情打开音效
            playSound('profileOpen');
        }
        
        function hidePlayerProfile() {
            const profile = document.getElementById('playerProfile');
            
            // 添加隐藏动画
            profile.style.animation = 'profileSlideOut 0.3s ease-out';
            
            setTimeout(() => {
                profile.style.display = 'none';
            }, 300);
            
            // 播放玩家详情关闭音效
            playSound('profileClose');
        }

        // 保存排行榜数据到本地存储
        function saveLeaderboardData(data) {
            try {
                localStorage.setItem('leaderboardData', JSON.stringify(data));
                localStorage.setItem('leaderboardTimestamp', Date.now());
            } catch (error) {
                console.log('无法保存排行榜数据:', error);
            }
        }

        // 从本地存储加载排行榜数据
        function loadLeaderboardData() {
            try {
                const savedData = localStorage.getItem('leaderboardData');
                const timestamp = localStorage.getItem('leaderboardTimestamp');
                
                if (savedData && timestamp) {
                    const dataAge = Date.now() - parseInt(timestamp);
                    const maxAge = 24 * 60 * 60 * 1000; // 24小时
                    
                    if (dataAge < maxAge) {
                        return JSON.parse(savedData);
                    }
                }
            } catch (error) {
                console.log('无法加载排行榜数据:', error);
            }
            return null;
        }

        // 显示通知函数（缺失的函数）
        function showNotification(message, notificationType = 'default') {
            const element = document.getElementById('eventNotification');
            
            // 添加关闭按钮
            element.innerHTML = `
                <span class="notification-message">${message}</span>
                <button class="notification-close">×</button>
            `;
            
            element.style.display = 'block';
            
            // 根据通知类型设置不同的样式
            element.className = 'event-notification';
            if (notificationType === 'achievement') {
                element.classList.add('achievement-notification');
            }
            
            // 添加关闭按钮点击事件
            const closeBtn = element.querySelector('.notification-close');
            closeBtn.addEventListener('click', function() {
                element.style.display = 'none';
                element.className = 'event-notification'; // 重置样式
            });
            
            setTimeout(() => {
                // 只有在通知仍显示时才执行隐藏
                if (element.style.display === 'block') {
                    element.style.display = 'none';
                    element.className = 'event-notification'; // 重置样式
                }
            }, 3000);
            
            // 播放事件音效
            playEventSound(notificationType);
        }

        function generateLeaderboardData() {
            // 首先尝试从本地存储加载数据
            const savedData = loadLeaderboardData();
            if (savedData) {
                return savedData;
            }
            
            // 获取当前玩家的统计数据
            const currentPlayerData = {
                name: '你',
                score: totalIncome,
                level: playerLevel, // 修复：将currentLevel改为playerLevel
                clicks: totalClicks,
                accuracy: totalAttempts > 0 ? ((totalClicks / totalAttempts) * 100).toFixed(1) : '0.0',
                playTime: totalPlayTime * 60,
                achievements: Object.values(achievements).filter(Boolean).length,
                coinsCollected: totalClicks, // 使用总点击数作为金币收集数
                hourlyRate: hourlyRate,
                isCurrentPlayer: true
            };

            // 基于当前玩家数据生成更合理的排行榜数据
            const players = [
                { 
                    name: '摸鱼大师', 
                    score: currentPlayerData.score * (1.5 + Math.random() * 0.5),
                    level: Math.min(currentPlayerData.level + Math.floor(Math.random() * 10) + 5, 50),
                    clicks: Math.floor(currentPlayerData.clicks * (1.8 + Math.random() * 0.7)),
                    accuracy: (85 + Math.random() * 14).toFixed(1),
                    playTime: Math.floor(currentPlayerData.playTime * (1.2 + Math.random() * 0.8)),
                    achievements: Math.min(currentPlayerData.achievements + Math.floor(Math.random() * 10) + 5, 25),
                    coinsCollected: Math.floor(currentPlayerData.clicks * (1.5 + Math.random() * 0.5)),
                    hourlyRate: currentPlayerData.hourlyRate * (1.3 + Math.random() * 0.4)
                },
                { 
                    name: '金币收割机', 
                    score: currentPlayerData.score * (1.3 + Math.random() * 0.4),
                    level: Math.min(currentPlayerData.level + Math.floor(Math.random() * 8) + 3, 45),
                    clicks: Math.floor(currentPlayerData.clicks * (1.4 + Math.random() * 0.5)),
                    accuracy: (78 + Math.random() * 12).toFixed(1),
                    playTime: Math.floor(currentPlayerData.playTime * (0.9 + Math.random() * 0.6)),
                    achievements: Math.min(currentPlayerData.achievements + Math.floor(Math.random() * 8) + 3, 20),
                    coinsCollected: Math.floor(currentPlayerData.clicks * (1.2 + Math.random() * 0.4)),
                    hourlyRate: currentPlayerData.hourlyRate * (1.1 + Math.random() * 0.3)
                },
                { 
                    name: '带薪摸鱼王', 
                    score: currentPlayerData.score * (1.1 + Math.random() * 0.3),
                    level: Math.min(currentPlayerData.level + Math.floor(Math.random() * 6) + 2, 40),
                    clicks: Math.floor(currentPlayerData.clicks * (1.1 + Math.random() * 0.4)),
                    accuracy: (72 + Math.random() * 15).toFixed(1),
                    playTime: Math.floor(currentPlayerData.playTime * (0.7 + Math.random() * 0.5)),
                    achievements: Math.min(currentPlayerData.achievements + Math.floor(Math.random() * 6) + 2, 18),
                    coinsCollected: Math.floor(currentPlayerData.clicks * (0.9 + Math.random() * 0.3)),
                    hourlyRate: currentPlayerData.hourlyRate * (0.95 + Math.random() * 0.25)
                },
                { 
                    name: '办公室忍者', 
                    score: currentPlayerData.score * (0.9 + Math.random() * 0.25),
                    level: Math.min(Math.max(currentPlayerData.level - Math.floor(Math.random() * 4), 1), 35),
                    clicks: Math.floor(currentPlayerData.clicks * (0.8 + Math.random() * 0.3)),
                    accuracy: (65 + Math.random() * 20).toFixed(1),
                    playTime: Math.floor(currentPlayerData.playTime * (0.5 + Math.random() * 0.4)),
                    achievements: Math.max(currentPlayerData.achievements - Math.floor(Math.random() * 4), 2),
                    coinsCollected: Math.floor(currentPlayerData.clicks * (0.7 + Math.random() * 0.25)),
                    hourlyRate: currentPlayerData.hourlyRate * (0.8 + Math.random() * 0.2)
                },
                currentPlayerData, // 当前玩家保持在中间位置
                { 
                    name: '摸鱼新手', 
                    score: currentPlayerData.score * (0.7 + Math.random() * 0.2),
                    level: Math.min(Math.max(currentPlayerData.level - Math.floor(Math.random() * 6) - 2, 1), 25),
                    clicks: Math.floor(currentPlayerData.clicks * (0.6 + Math.random() * 0.25)),
                    accuracy: (55 + Math.random() * 25).toFixed(1),
                    playTime: Math.floor(currentPlayerData.playTime * (0.3 + Math.random() * 0.3)),
                    achievements: Math.max(currentPlayerData.achievements - Math.floor(Math.random() * 6) - 2, 1),
                    coinsCollected: Math.floor(currentPlayerData.clicks * (0.5 + Math.random() * 0.2)),
                    hourlyRate: currentPlayerData.hourlyRate * (0.6 + Math.random() * 0.15)
                },
                { 
                    name: '金币爱好者', 
                    score: currentPlayerData.score * (0.5 + Math.random() * 0.15),
                    level: Math.min(Math.max(currentPlayerData.level - Math.floor(Math.random() * 8) - 3, 1), 20),
                    clicks: Math.floor(currentPlayerData.clicks * (0.4 + Math.random() * 0.2)),
                    accuracy: (45 + Math.random() * 30).toFixed(1),
                    playTime: Math.floor(currentPlayerData.playTime * (0.2 + Math.random() * 0.2)),
                    achievements: Math.max(currentPlayerData.achievements - Math.floor(Math.random() * 8) - 3, 0),
                    coinsCollected: Math.floor(currentPlayerData.clicks * (0.3 + Math.random() * 0.15)),
                    hourlyRate: currentPlayerData.hourlyRate * (0.4 + Math.random() * 0.1)
                },
                { 
                    name: '办公室达人', 
                    score: currentPlayerData.score * (0.3 + Math.random() * 0.1),
                    level: Math.min(Math.max(currentPlayerData.level - Math.floor(Math.random() * 10) - 5, 1), 15),
                    clicks: Math.floor(currentPlayerData.clicks * (0.2 + Math.random() * 0.15)),
                    accuracy: (40 + Math.random() * 35).toFixed(1),
                    playTime: Math.floor(currentPlayerData.playTime * (0.1 + Math.random() * 0.15)),
                    achievements: Math.max(currentPlayerData.achievements - Math.floor(Math.random() * 10) - 5, 0),
                    coinsCollected: Math.floor(currentPlayerData.clicks * (0.15 + Math.random() * 0.1)),
                    hourlyRate: currentPlayerData.hourlyRate * (0.25 + Math.random() * 0.08)
                }
            ];
            
            // 按分数排序并添加排名
            players.sort((a, b) => b.score - a.score);
            players.forEach((player, index) => {
                player.rank = index + 1;
            });
            
            return players;
        }

        // 定期保存排行榜数据
        function saveLeaderboardDataPeriodically() {
            const data = generateLeaderboardData();
            saveLeaderboardData(data);
        }

        // 每5分钟保存一次排行榜数据
        setInterval(saveLeaderboardDataPeriodically, 5 * 60 * 1000);

        // 添加键盘快捷键
        document.addEventListener('keydown', function(e) {
            if (e.key === 'L' || e.key === 'l') {
                showLeaderboard();
            } else if (e.key === 'Escape') {
                hideLeaderboard();
                hideDailyChallenges();
            }
        });
    </script>
</body>
</html>