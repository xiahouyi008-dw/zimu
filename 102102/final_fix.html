<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆä¿®å¤å·¥å…· - æŒ‘æˆ˜ç³»ç»Ÿ</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 90%;
        }
        h1 { 
            margin-bottom: 30px; 
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .fix-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 20px;
            border-radius: 15px;
            cursor: pointer;
            margin: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76,175,80,0.4);
            position: relative;
            overflow: hidden;
        }
        .fix-button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76,175,80,0.6);
        }
        .fix-button:active { transform: translateY(0); }
        .fix-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        .fix-button:hover::before {
            left: 100%;
        }
        .status { 
            margin: 30px 0; 
            padding: 20px; 
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            font-size: 18px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-left: 4px solid #4CAF50;
        }
        .instructions {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
            font-size: 16px;
            line-height: 1.8;
        }
        .instructions h3 {
            margin-top: 0;
            color: #ffd700;
            font-size: 1.4em;
        }
        .test-area {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid rgba(255,255,255,0.2);
        }
        .test-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .test-button {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            padding: 12px 24px;
            font-size: 14px;
            border-radius: 8px;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(33,150,243,0.3);
        }
        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(33,150,243,0.5);
        }
        .console-output {
            background: rgba(0,0,0,0.3);
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
            text-align: left;
        }
        .warning {
            background: rgba(255,152,0,0.2);
            border: 1px solid rgba(255,152,0,0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ æœ€ç»ˆä¿®å¤å·¥å…·</h1>
        
        <div class="warning">
            <strong>âš ï¸ é‡è¦ï¼š</strong> æ­¤ä¿®å¤å°†å®Œå…¨é‡å†™æŒ‘æˆ˜ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç¡®ä¿æŒ‘æˆ˜è¿›åº¦èƒ½å¤Ÿå®æ—¶æ›´æ–°ï¼
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨æ­¥éª¤ï¼š</h3>
            <ol>
                <li><strong>ç¬¬ä¸€æ­¥ï¼š</strong>ç‚¹å‡»ã€ğŸ”§ åº”ç”¨æœ€ç»ˆä¿®å¤ã€‘æŒ‰é’®</li>
                <li><strong>ç¬¬äºŒæ­¥ï¼š</strong>ä¿®å¤å®Œæˆåï¼Œç‚¹å‡»ã€ğŸ® æ‰“å¼€æ¸¸æˆã€‘</li>
                <li><strong>ç¬¬ä¸‰æ­¥ï¼š</strong>åœ¨æ¸¸æˆä¸­ç‚¹å‡»é‡‘å¸ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡º</li>
                <li><strong>ç¬¬å››æ­¥ï¼š</strong>ä½¿ç”¨æµ‹è¯•æŒ‰é’®éªŒè¯ä¿®å¤æ•ˆæœ</li>
                <li><strong>ç¬¬äº”æ­¥ï¼š</strong>æŸ¥çœ‹æŒ‘æˆ˜è¿›åº¦æ˜¯å¦å®æ—¶æ›´æ–°</li>
            </ol>
        </div>

        <button class="fix-button" onclick="applyUltimateFix()">ğŸ”§ åº”ç”¨æœ€ç»ˆä¿®å¤</button>
        <button class="fix-button" onclick="openGame()" style="background: linear-gradient(45deg, #ff9800, #f57c00);">ğŸ® æ‰“å¼€æ¸¸æˆ</button>
        
        <div id="status" class="status">ç‚¹å‡»ã€åº”ç”¨æœ€ç»ˆä¿®å¤ã€‘å¼€å§‹ä¿®å¤æŒ‘æˆ˜ç³»ç»Ÿ</div>
        
        <div class="test-area">
            <h3>ğŸ§ª å®æ—¶æµ‹è¯•åŒº</h3>
            <p>ä¿®å¤å®Œæˆåï¼Œä½¿ç”¨è¿™äº›æŒ‰é’®æµ‹è¯•æŒ‘æˆ˜ç³»ç»Ÿï¼š</p>
            <div class="test-buttons">
                <button class="test-button" onclick="testClickChallenge()">ğŸ’° æµ‹è¯•ç‚¹å‡»æŒ‘æˆ˜</button>
                <button class="test-button" onclick="testAccuracyChallenge()">ğŸ¯ æµ‹è¯•ç²¾å‡†æŒ‘æˆ˜</button>
                <button class="test-button" onclick="showChallengeStatus()">ğŸ“Š æŸ¥çœ‹æŒ‘æˆ˜çŠ¶æ€</button>
                <button class="test-button" onclick="clearConsole()">ğŸ§¹ æ¸…ç©ºæ§åˆ¶å°</button>
            </div>
            <div id="consoleOutput" class="console-output">
                æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
            </div>
        </div>
    </div>

    <script>
        let gameWindow = null;
        let fixApplied = false;

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.innerHTML = message;
            if (type === 'success') {
                status.style.borderLeftColor = '#4CAF50';
                status.style.background = 'rgba(76,175,80,0.2)';
            } else if (type === 'error') {
                status.style.borderLeftColor = '#f44336';
                status.style.background = 'rgba(244,67,54,0.2)';
            } else {
                status.style.borderLeftColor = '#ff9800';
                status.style.background = 'rgba(255,152,0,0.2)';
            }
        }

        function addConsoleOutput(message) {
            const consoleOutput = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `[${timestamp}] ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('consoleOutput').innerHTML = 'æ§åˆ¶å°å·²æ¸…ç©º...\n';
        }

        function applyUltimateFix() {
            updateStatus('ğŸ”„ æ­£åœ¨åŠ è½½æœ€ç»ˆä¿®å¤è„šæœ¬...', 'info');
            addConsoleOutput('å¼€å§‹åº”ç”¨æœ€ç»ˆä¿®å¤...');
            
            // åŠ è½½ç»ˆæä¿®å¤è„šæœ¬
            const script = document.createElement('script');
            script.src = '/ultimate_fix.js';
            script.onload = function() {
                updateStatus('âœ… æœ€ç»ˆä¿®å¤å·²åº”ç”¨ï¼ç°åœ¨å¯ä»¥æ‰“å¼€æ¸¸æˆæµ‹è¯•', 'success');
                addConsoleOutput('âœ… ç»ˆæä¿®å¤è„šæœ¬åŠ è½½æˆåŠŸ');
                addConsoleOutput('ä¿®å¤å†…å®¹åŒ…æ‹¬ï¼š');
                addConsoleOutput('- é‡å†™updateChallengeProgresså‡½æ•°');
                addConsoleOutput('- åˆ›å»ºupdateAllChallengeDisplayså‡½æ•°');
                addConsoleOutput('- ä¿®å¤é‡‘å¸ç‚¹å‡»äº‹ä»¶ç›‘å¬');
                addConsoleOutput('- æ·»åŠ æµ‹è¯•å’ŒçŠ¶æ€æ£€æŸ¥åŠŸèƒ½');
                fixApplied = true;
            };
            script.onerror = function() {
                updateStatus('âŒ ä¿®å¤è„šæœ¬åŠ è½½å¤±è´¥', 'error');
                addConsoleOutput('âŒ ä¿®å¤è„šæœ¬åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            };
            document.head.appendChild(script);
        }

        function openGame() {
            if (!fixApplied) {
                updateStatus('âŒ è¯·å…ˆåº”ç”¨æœ€ç»ˆä¿®å¤ï¼', 'error');
                addConsoleOutput('âŒ é”™è¯¯ï¼šå¿…é¡»å…ˆåº”ç”¨ä¿®å¤æ‰èƒ½æ‰“å¼€æ¸¸æˆ');
                return;
            }
            
            try {
                // ä½¿ç”¨åŸç‰ˆæ¸¸æˆçš„è‹±æ–‡æ–‡ä»¶åç‰ˆæœ¬
                gameWindow = window.open('/original_game.html', 'game', 'width=1200,height=800,scrollbars=yes,resizable=yes');
                
                setTimeout(() => {
                    if (gameWindow && !gameWindow.closed) {
                        updateStatus('âœ… æ¸¸æˆå·²æ‰“å¼€ï¼ç­‰å¾…3ç§’åæ³¨å…¥ä¿®å¤ä»£ç ', 'success');
                        addConsoleOutput('æ¸¸æˆçª—å£æ‰“å¼€æˆåŠŸï¼Œå‡†å¤‡æ³¨å…¥ä¿®å¤ä»£ç ...');
                        
                        // ç­‰å¾…æ¸¸æˆåŠ è½½åæ‰§è¡Œä¿®å¤
                        setTimeout(() => {
                            injectGameFix();
                        }, 3000);
                    } else {
                        updateStatus('âŒ æ¸¸æˆçª—å£æ‰“å¼€å¤±è´¥', 'error');
                        addConsoleOutput('âŒ æ¸¸æˆçª—å£æ‰“å¼€å¤±è´¥æˆ–è¢«é˜»æ­¢');
                    }
                }, 1000);
                
            } catch (error) {
                updateStatus('âŒ æ— æ³•æ‰“å¼€æ¸¸æˆï¼š' + error.message, 'error');
                addConsoleOutput('âŒ æ‰“å¼€æ¸¸æˆæ—¶å‡ºé”™ï¼š' + error.message);
            }
        }

        function injectGameFix() {
            if (!gameWindow || gameWindow.closed) {
                updateStatus('âŒ æ¸¸æˆçª—å£å·²å…³é—­', 'error');
                addConsoleOutput('âŒ æ¸¸æˆçª—å£å·²å…³é—­ï¼Œæ— æ³•æ³¨å…¥ä¿®å¤');
                return;
            }
            
            try {
                // åœ¨æ¸¸æˆçª—å£ä¸­æ‰§è¡Œä¿®å¤
                const gameScript = gameWindow.document.createElement('script');
                gameScript.textContent = `
                    console.log('ğŸ® æ¸¸æˆçª—å£ä¿®å¤ä»£ç æ³¨å…¥æˆåŠŸ');
                    console.log('ğŸ”„ å¼€å§‹æ‰§è¡Œæ¸¸æˆå†…ä¿®å¤...');
                    
                    // ç¡®ä¿æŒ‘æˆ˜æ•°æ®å­˜åœ¨
                    if (!window.dailyChallenges) {
                        console.log('âŒ æ¸¸æˆå†…dailyChallengesæœªæ‰¾åˆ°ï¼Œé‡æ–°åˆå§‹åŒ–...');
                        window.dailyChallenges = ${JSON.stringify([
                            {
                                id: 'click_100',
                                title: 'æ‘¸é±¼æ–°æ‰‹',
                                description: 'ç‚¹å‡»é‡‘å¸è¾¾åˆ°100æ¬¡',
                                icon: 'ğŸ¯',
                                target: 100,
                                reward: 500,
                                type: 'click',
                                progress: 0,
                                completed: false,
                                claimed: false
                            },
                            {
                                id: 'time_30min',
                                title: 'æ—¶é—´ç®¡ç†å¤§å¸ˆ',
                                description: 'ç´¯è®¡æ‘¸é±¼30åˆ†é’Ÿ',
                                icon: 'â°',
                                target: 30 * 60 * 1000,
                                reward: 1000,
                                type: 'time',
                                progress: 0,
                                completed: false,
                                claimed: false
                            },
                            {
                                id: 'accuracy_80',
                                title: 'ç²¾å‡†ç‚¹å‡»',
                                description: 'æˆåŠŸç‚¹å‡»é‡‘å¸80æ¬¡',
                                icon: 'ğŸ¯',
                                target: 80,
                                reward: 800,
                                type: 'accuracy',
                                progress: 0,
                                completed: false,
                                claimed: false
                            }
                        ])};
                        localStorage.setItem('dailyChallenges', JSON.stringify(window.dailyChallenges));
                    }
                    
                    // æ£€æŸ¥å¹¶ä¿®å¤é‡‘å¸ç‚¹å‡»äº‹ä»¶
                    const canvas = document.getElementById('coinCanvas');
                    if (canvas) {
                        console.log('ğŸ¯ æ‰¾åˆ°é‡‘å¸ç”»å¸ƒï¼Œä¿®å¤ç‚¹å‡»äº‹ä»¶...');
                        
                        // ç§»é™¤æ—§çš„ç‚¹å‡»äº‹ä»¶
                        const newCanvas = canvas.cloneNode(true);
                        canvas.parentNode.replaceChild(newCanvas, canvas);
                        
                        // æ·»åŠ æ–°çš„ç‚¹å‡»äº‹ä»¶
                        newCanvas.addEventListener('click', function(e) {
                            console.log('ğŸ’° æ£€æµ‹åˆ°é‡‘å¸ç”»å¸ƒç‚¹å‡»ï¼');
                            
                            const rect = newCanvas.getBoundingClientRect();
                            const clickX = e.clientX - rect.left;
                            const clickY = e.clientY - rect.top;
                            
                            console.log('ç‚¹å‡»åæ ‡:', clickX, clickY);
                            
                            // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»åˆ°é‡‘å¸
                            let coinClicked = false;
                            if (window.coins && Array.isArray(window.coins)) {
                                window.coins.forEach((coin, index) => {
                                    const distance = Math.sqrt(Math.pow(clickX - coin.x, 2) + Math.pow(clickY - coin.y, 2));
                                    if (distance < coin.size) {
                                        console.log('ğŸ¯ æˆåŠŸç‚¹å‡»é‡‘å¸ï¼');
                                        coinClicked = true;
                                        
                                        // âœ… æ›´æ–°æŒ‘æˆ˜è¿›åº¦
                                        if (typeof updateChallengeProgress === 'function') {
                                            updateChallengeProgress('click', 1);
                                            updateChallengeProgress('accuracy', 1);
                                        } else {
                                            console.log('âŒ updateChallengeProgresså‡½æ•°æœªæ‰¾åˆ°');
                                        }
                                        
                                        // ç§»é™¤è¢«ç‚¹å‡»çš„é‡‘å¸
                                        window.coins.splice(index, 1);
                                        
                                        // å¢åŠ åˆ†æ•°
                                        if (typeof updateScore === 'function') {
                                            updateScore(10);
                                        }
                                    }
                                });
                            }
                            
                            if (!coinClicked) {
                                console.log('âŒ æœªç‚¹å‡»åˆ°é‡‘å¸');
                            }
                        });
                        
                        console.log('âœ… é‡‘å¸ç‚¹å‡»äº‹ä»¶ä¿®å¤å®Œæˆï¼');
                    } else {
                        console.log('âŒ æœªæ‰¾åˆ°coinCanvaså…ƒç´ ');
                    }
                    
                    console.log('ğŸ‰ æ¸¸æˆå†…ä¿®å¤å®Œæˆï¼ç°åœ¨ç‚¹å‡»é‡‘å¸æµ‹è¯•æŒ‘æˆ˜è¿›åº¦');
                    console.log('ğŸ’¡ æç¤ºï¼šæ¯æ¬¡ç‚¹å‡»é‡‘å¸åº”è¯¥ä¼šå¢åŠ æŒ‘æˆ˜1å’ŒæŒ‘æˆ˜3çš„è¿›åº¦');
                `;
                
                gameWindow.document.head.appendChild(gameScript);
                updateStatus('âœ… æ¸¸æˆä¿®å¤ä»£ç æ³¨å…¥æˆåŠŸï¼å¼€å§‹ç‚¹å‡»é‡‘å¸æµ‹è¯•', 'success');
                addConsoleOutput('âœ… æ¸¸æˆä¿®å¤ä»£ç æ³¨å…¥æˆåŠŸ');
                addConsoleOutput('ç°åœ¨è¯·åœ¨æ¸¸æˆä¸­ç‚¹å‡»é‡‘å¸ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡º');
                
            } catch (error) {
                updateStatus('âŒ æ¸¸æˆä¿®å¤æ³¨å…¥å¤±è´¥ï¼š' + error.message, 'error');
                addConsoleOutput('âŒ æ¸¸æˆä¿®å¤æ³¨å…¥å¤±è´¥ï¼š' + error.message);
            }
        }

        function testClickChallenge() {
            if (!gameWindow || gameWindow.closed) {
                updateStatus('âŒ è¯·å…ˆæ‰“å¼€æ¸¸æˆ', 'error');
                addConsoleOutput('âŒ é”™è¯¯ï¼šæ¸¸æˆçª—å£æœªæ‰“å¼€');
                return;
            }
            
            try {
                const script = gameWindow.document.createElement('script');
                script.textContent = `
                    if (typeof updateChallengeProgress === 'function') {
                        updateChallengeProgress('click', 5);
                        console.log('ğŸ§ª æµ‹è¯•ï¼šæŒ‘æˆ˜1è¿›åº¦+5');
                    } else {
                        console.log('âŒ updateChallengeProgresså‡½æ•°æœªæ‰¾åˆ°');
                    }
                `;
                gameWindow.document.head.appendChild(script);
                addConsoleOutput('ğŸ§ª å·²å‘é€ç‚¹å‡»æŒ‘æˆ˜æµ‹è¯•ï¼ˆ+5ï¼‰');
            } catch (error) {
                addConsoleOutput('âŒ æµ‹è¯•å¤±è´¥ï¼š' + error.message);
            }
        }

        function testAccuracyChallenge() {
            if (!gameWindow || gameWindow.closed) {
                updateStatus('âŒ è¯·å…ˆæ‰“å¼€æ¸¸æˆ', 'error');
                addConsoleOutput('âŒ é”™è¯¯ï¼šæ¸¸æˆçª—å£æœªæ‰“å¼€');
                return;
            }
            
            try {
                const script = gameWindow.document.createElement('script');
                script.textContent = `
                    if (typeof updateChallengeProgress === 'function') {
                        updateChallengeProgress('accuracy', 3);
                        console.log('ğŸ§ª æµ‹è¯•ï¼šæŒ‘æˆ˜3è¿›åº¦+3');
                    } else {
                        console.log('âŒ updateChallengeProgresså‡½æ•°æœªæ‰¾åˆ°');
                    }
                `;
                gameWindow.document.head.appendChild(script);
                addConsoleOutput('ğŸ§ª å·²å‘é€ç²¾å‡†æŒ‘æˆ˜æµ‹è¯•ï¼ˆ+3ï¼‰');
            } catch (error) {
                addConsoleOutput('âŒ æµ‹è¯•å¤±è´¥ï¼š' + error.message);
            }
        }

        function showChallengeStatus() {
            if (!gameWindow || gameWindow.closed) {
                updateStatus('âŒ è¯·å…ˆæ‰“å¼€æ¸¸æˆ', 'error');
                addConsoleOutput('âŒ é”™è¯¯ï¼šæ¸¸æˆçª—å£æœªæ‰“å¼€');
                return;
            }
            
            try {
                const script = gameWindow.document.createElement('script');
                script.textContent = `
                    if (window.dailyChallenges) {
                        console.log('ğŸ“Š å½“å‰æŒ‘æˆ˜çŠ¶æ€:');
                        window.dailyChallenges.forEach((c, i) => {
                            console.log(\`æŒ‘æˆ˜\${i+1}: \${c.title} - \${c.progress}/\${c.target} (å®Œæˆ: \${c.completed})\`);
                        });
                    } else {
                        console.log('âŒ dailyChallengesæœªå®šä¹‰');
                    }
                `;
                gameWindow.document.head.appendChild(script);
                addConsoleOutput('ğŸ“Š å·²å‘é€çŠ¶æ€æŸ¥è¯¢åˆ°æ¸¸æˆæ§åˆ¶å°');
            } catch (error) {
                addConsoleOutput('âŒ çŠ¶æ€æŸ¥è¯¢å¤±è´¥ï¼š' + error.message);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.onload = function() {
            updateStatus('ğŸš€ æœ€ç»ˆä¿®å¤å·¥å…·å·²å‡†å¤‡å°±ç»ªï¼');
            addConsoleOutput('æœ€ç»ˆä¿®å¤å·¥å…·åŠ è½½å®Œæˆ');
            addConsoleOutput('è¯·æŒ‰ç…§æ­¥éª¤è¿›è¡Œä¿®å¤å’Œæµ‹è¯•');
        };
    </script>
</body>
</html>